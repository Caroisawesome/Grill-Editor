(function(){var XY,pt,u,_base,_i,_len,_ref,__hasProp={}.hasOwnProperty,__indexOf=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},__slice=[].slice,__extends=function(t,e){function n(){this.constructor=t}for(var r in e)__hasProp.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},__bind=function(t,e){return function(){return t.apply(e,arguments)}};for(this.ABM={},ABM.root=this,function(){var t,e,n,r;for(this.requestAnimFrame=this.requestAnimationFrame||null,this.cancelAnimFrame=this.cancelAnimationFrame||null,r=["ms","moz","webkit","o"],e=0,n=r.length;n>e;e++)t=r[e],this.requestAnimFrame||(this.requestAnimFrame||(this.requestAnimFrame=this[t+"RequestAnimationFrame"]),this.cancelAnimFrame||(this.cancelAnimFrame=this[t+"CancelAnimationFrame"]),this.cancelAnimFrame||(this.cancelAnimFrame=this[t+"CancelRequestAnimationFrame"]));return this.requestAnimFrame||(this.requestAnimFrame=function(t){return this.setTimeout(t,1e3/60)}),this.cancelAnimFrame||(this.cancelAnimFrame=function(t){return this.clearTimeout(t)})}(),(_base=Array.prototype).indexOf||(_base.indexOf=function(t){var e,n,r,i;for(e=r=0,i=this.length;i>r;e=++r)if(n=this[e],n===t)return e;return-1}),ABM.util=u={error:function(t){throw Error(t)},isArray:Array.isArray||function(t){return!(!(t&&t.concat&&t.unshift)||t.callee)},isFunction:function(t){return!!(t&&t.constructor&&t.call&&t.apply)},isString:function(t){return!!(""===t||t&&t.charCodeAt&&t.substr)},randomInt:function(t){return Math.floor(Math.random()*t)},randomInt2:function(t,e){return t+Math.floor(Math.random()*(e-t))},randomFloat:function(t){return Math.random()*t},randomFloat2:function(t,e){return t+Math.random()*(e-t)},randomCentered:function(t){return this.randomFloat2(-t/2,t/2)},log10:function(t){return Math.log(t)/Math.LN10},logN:function(t,e){return Math.log(t)/Math.log(e)},ln:function(t){return Math.log(t)},mod:function(t,e){return(t%e+e)%e},wrap:function(t,e,n){return e+this.mod(t-e,n-e)},clamp:function(t,e,n){return Math.max(Math.min(t,n),e)},sign:function(t){return 0>t?-1:1},aToFixed:function(t,e,n){var r;return null==e&&(e=2),null==n&&(n=", "),"["+function(){var n,i,s;for(s=[],n=0,i=t.length;i>n;n++)r=t[n],s.push(r.toFixed(e));return s}().join(n)+"]"},randomColor:function(t){var e,n;for(null==t&&(t=[]),null!=t.str&&(t.str=null),e=n=0;2>=n;e=++n)t[e]=this.randomInt(256);return t},randomGray:function(t,e,n){var r,i,s;if(null==t&&(t=[]),null==e&&(e=64),null==n&&(n=192),2===arguments.length)return this.randomGray(null,t,e);for(null!=t.str&&(t.str=null),i=this.randomInt2(e,n),r=s=0;2>=s;r=++s)t[r]=i;return t},setColor:function(t,e,n,r,i){return null==i&&(i=null),null!=t.str&&(t.str=null),t[0]=e,t[1]=n,t[2]=r,null!=i&&(t[3]=i),t},scaleColor:function(t,e,n){var r,i,s,o;for(null==n&&(n=[]),null!=n.str&&(n.str=null),r=s=0,o=t.length;o>s;r=++s)i=t[r],n[r]=this.clamp(Math.round(i*e),0,255);return n},colorStr:function(t){var e;return null!=(e=t.str)?e:t.str=3===t.length?"rgb("+t+")":"rgba("+t+")"},colorsEqual:function(t,e){return""+t==""+e},isLittleEndian:function(){var t,e;return e=new Uint8ClampedArray(4),t=new Uint32Array(e.buffer),t[0]=16909060,4===e[0]},degToRad:function(t){return t*Math.PI/180},radToDeg:function(t){return 180*t/Math.PI},subtractRads:function(t,e){var n,r;return r=t-e,n=Math.PI,-n>=r&&(r+=2*n),r>n&&(r-=2*n),r},ownKeys:function(t){var e,n,r;r=[];for(e in t)__hasProp.call(t,e)&&(n=t[e],r.push(e));return r},ownVarKeys:function(t){var e,n,r;r=[];for(e in t)__hasProp.call(t,e)&&(n=t[e],this.isFunction(n)||r.push(e));return r},any:function(t){return 0!==t.length},empty:function(t){return 0===t.length},clone:function(t){return t.slice(0)},last:function(t){return this.empty(t)&&this.error("last: empty array"),t[t.length-1]},oneOf:function(t){return this.empty(t)&&this.error("oneOf: empty array"),t[this.randomInt(t.length)]},nOf:function(t,e){var n,r;for(e>t.length&&this.error("nOf: n > length"),r=[];e>r.length;)n=this.oneOf(t),0>__indexOf.call(r,n)&&r.push(n);return r},removeItem:function(t,e){var n;return-1!==(n=t.indexOf(e))&&t.splice(n,1),0>n&&this.error("removeItem: item not found"),n},shuffle:function(t){return t.sort(function(){return.5-Math.random()})},minOneOf:function(t,e,n){var r,i,s,o,a,u,h;for(null==n&&(n=!1),this.empty(t)&&this.error("minOneOf: empty array"),s=1/0,i=null,this.isString(e)&&(a=e,e=function(t){return t[a]}),u=0,h=t.length;h>u;u++)r=t[u],s>(o=e(r))&&(s=o,i=r);return n?[i,s]:i},maxOneOf:function(t,e,n){var r,i,s,o,a,u,h;for(null==n&&(n=!1),this.empty(t)&&this.error("maxOneOf: empty array"),s=-1/0,i=null,this.isString(e)&&(a=e,e=function(t){return t[a]}),u=0,h=t.length;h>u;u++)r=t[u],(o=e(r))>s&&(s=o,i=r);return n?[i,s]:i},histOf:function(t,e,n){var r,i,s,o,a,u,h,l,c,p;for(s=[],this.isString(n)&&(a=n,n=function(t){return t[a]}),h=0,c=t.length;c>h;h++)r=t[h],i=Math.floor(n(r)/e),s[i]=null!=(o=s[i])?o+1:1;for(i=l=0,p=s.length;p>l;i=++l)u=s[i],null==u&&(s[i]=0);return s},sortBy:function(t,e){return t.sort(function(t,n){return t[e]-n[e]})},uniq:function(t){var e,n,r;for(e=n=r=t.length-1;n>=1;e=n+=-1)t[e-1]===t[e]&&t.splice(e,1);return t},flatten:function(t){return t.reduce(function(t,e){return t.concat(e)})},binarySearch:function(t,e,n){var r,i,s,o;for(null==n&&(n=function(t){return t}),s=0,o=t.length-1,r=Math.floor((s+o)/2);(i=n(t[r]))!==e&&o>s;)i>e&&(o=r-1),e>i&&(s=r+1),r=Math.floor((o+s)/2);return n(t[r])===e?r:-1},aMax:function(t){return Math.max.apply(Math,t)},aMin:function(t){return Math.min.apply(Math,t)},aPush:function(t,e){return t.push.apply(t,e)},radsToward:function(t,e,n,r){var i,s,o;return i=Math.PI,s=n-t,o=r-e,0===s?0>o?3*i/2:o>0?i/2:0:Math.atan(o/s)+(0>s?i:0)},inCone:function(t,e,n,r,i,s,o){var a;return this.distance(r,i,s,o)>n?!1:(a=this.radsToward(r,i,s,o),e/2>=Math.abs(this.subtractRads(t,a)))},distance:function(t,e,n,r){var i,s;return i=t-n,s=e-r,Math.sqrt(i*i+s*s)},sqDistance:function(t,e,n,r){var i,s;return i=t-n,s=e-r,i*i+s*s},torusDistance:function(t,e,n,r,i,s){return Math.sqrt(this.torusSqDistance(t,e,n,r,i,s))},torusSqDistance:function(t,e,n,r,i,s){var o,a,u,h;return o=Math.abs(n-t),u=Math.abs(r-e),a=Math.min(o,i-o),h=Math.min(u,s-u),a*a+h*h},torusWraps:function(t,e,n,r,i,s){var o,a;return o=Math.abs(n-t),a=Math.abs(r-e),o>i-o||a>s-a},torus4Pts:function(t,e,n,r,i,s){var o,a;return o=t>n?n+i:n-i,a=e>r?r+s:r-s,[[n,r],[o,r],[n,a],[o,a]]},torusPt:function(t,e,n,r,i,s){var o,a,u,h;return a=t>n?n+i:n-i,h=e>r?r+s:r-s,o=Math.abs(a-t)<Math.abs(n-t)?a:n,u=Math.abs(h-e)<Math.abs(r-e)?h:r,[o,u]},torusRadsToward:function(t,e,n,r,i,s){var o;return o=this.torusPt(t,e,n,r,i,s),n=o[0],r=o[1],this.radsToward(t,e,n,r)},inTorusCone:function(t,e,n,r,i,s,o,a,u){var h,l,c,p;for(p=this.torus4Pts(r,i,s,o,a,u),l=0,c=p.length;c>l;l++)if(h=p[l],this.inCone(t,e,n,r,i,h[0],h[1]))return!0;return!1},createCanvas:function(t,e){var n;return n=document.createElement("canvas"),n.width=t,n.height=e,n},createCtx:function(t,e,n){var r;return null==n&&(n="2d"),r=this.createCanvas(t,e),"2d"===n?r.getContext("2d"):r.getContext("webgl")||r.getContext("experimental-webgl")},createLayer:function(t,e,n,r,i){return null==i&&(i="2d"),i=this.createCtx(e,n,i),i.canvas.setAttribute("style","position:absolute;top:0;left:0;z-index:"+r),document.getElementById(t).appendChild(i.canvas),i},clearCtx:function(t){return null!=t.save?(t.save(),t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,t.canvas.width,t.canvas.height),t.restore()):(t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT))},fillCtx:function(t,e){return null!=t.fillStyle?(t.save(),t.setTransform(1,0,0,1,0,0),t.fillStyle=this.colorStr(e),t.fillRect(0,0,t.canvas.width,t.canvas.height),t.restore()):(t.clearColor.apply(t,__slice.call(e).concat([1])),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT))},ctxDrawText:function(t,e,n,r){return null==r&&(r=[0,0,0]),t.fillStyle=this.colorStr(r),t.fillText(e,n[0],n[1])},ctxTextParams:function(t,e,n,r){return null==n&&(n="center"),null==r&&(r="middle"),t.font=e,t.textAlign=n,t.textBaseline=r},ctxLabelParams:function(t,e,n){return t.labelColor=e,t.labelXY=n},importImage:function(t,e){var n;return null==e&&(e=function(){}),n=new Image,n.onload=function(){return e(n)},n.src=t,n},imageToCtx:function(t){var e;return e=this.createCtx(t.width,t.height),e.drawImage(t,0,0),e},ctxToImage:function(t,e){var n;return null==e&&(e=function(){}),n=new Image,n.onload=function(){return e(n)},n.src=t.canvas.toDataURL("image/png"),n},ctxToImageData:function(t){return t.getImageData(0,0,t.canvas.width,t.canvas.height)},canvasToImage:function(t){return ctxToImage(t.getContext("2d"))},canvasToImageData:function(t){return ctxToImageData(t.getContext("2d"))},imageToCanvas:function(t){return imageToCtx(t).canvas},drawCenteredImage:function(t,e,n,r,i,s,o){return t.translate(r,i),t.rotate(n),t.drawImage(e,-s/2,-o/2)},resizeCtx:function(t,e,n,r){return null==r&&(r=!1),this.ctxToImage(t,function(i){return r?t.drawImage(i,0,0,e,n):t.drawImage(i,0,0)}),t.canvas.width=e,t.canvas.height=n}},ABM.shapes=function(){var t,e,n,r,i,s,o;return s=function(t,e){var n,r,i,s;for(n=i=0,s=e.length;s>i;n=++i)r=e[n],0===n?t.moveTo(r[0],r[1]):t.lineTo(r[0],r[1]);return null},n=function(t,e,n,r){return t.arc(e,n,r/2,0,2*Math.PI)},t=function(t,e,n,r){return t.arc(e,n,r/2,0,2*Math.PI,!0)},e=function(t,e,n,r,i){return t.scale(1,-1),t.drawImage(i,e-r/2,n-r/2,r,r),t.scale(1,-1)},r=function(t,e,n,r){return t.fillRect(e-r/2,n-r/2,r,r)},i=function(t,e){return console.log("fillSlot "+t.x+" "+t.y,e),t.ctx.save(),t.ctx.scale(1,-1),t.ctx.drawImage(e,t.x,-(t.y+t.size),t.size,t.size),t.ctx.restore()},o=[],{"default":{rotate:!0,draw:function(t){return s(t,[[.5,0],[-.5,-.5],[-.25,0],[-.5,.5]])}},triangle:{rotate:!0,draw:function(t){return s(t,[[.5,0],[-.5,-.4],[-.5,.4]])}},arrow:{rotate:!0,draw:function(t){return s(t,[[.5,0],[0,.5],[0,.2],[-.5,.2],[-.5,-.2],[0,-.2],[0,-.5]])}},bug:{rotate:!0,draw:function(t){return t.strokeStyle=t.fillStyle,t.lineWidth=.05,s(t,[[.4,.225],[.2,0],[.4,-.225]]),t.stroke(),t.beginPath(),n(t,.12,0,.26),n(t,-.05,0,.26),n(t,-.27,0,.4)}},pyramid:{rotate:!1,draw:function(t){return s(t,[[0,.5],[-.433,-.25],[.433,-.25]])}},circle:{shortcut:function(t,e,r,i){return t.beginPath(),n(t,e,r,i),t.closePath(),t.fill()},rotate:!1,draw:function(t){return n(t,0,0,1)}},square:{shortcut:function(t,e,n,i){return r(t,e,n,i)},rotate:!1,draw:function(t){return r(t,0,0,1)}},pentagon:{rotate:!1,draw:function(t){return s(t,[[0,.45],[-.45,.1],[-.3,-.45],[.3,-.45],[.45,.1]])}},ring:{rotate:!1,draw:function(e){return n(e,0,0,1),e.closePath(),t(e,0,0,.6)}},cup:{shortcut:function(t,n,r,i){return e(t,n,r,i,this.img)},rotate:!1,img:u.importImage("http://goo.gl/HrBBb"),draw:function(t){return e(t,.5,.5,1,this.img)}},person:{rotate:!1,draw:function(t){return s(t,[[.15,.2],[.3,0],[.125,-.1],[.125,.05],[.1,-.15],[.25,-.5],[.05,-.5],[0,-.25],[-.05,-.5],[-.25,-.5],[-.1,-.15],[-.125,.05],[-.125,-.1],[-.3,0],[-.15,.2]]),t.closePath(),n(t,0,.35,.3)}},names:function(){var t,e,n;n=[];for(t in this)__hasProp.call(this,t)&&(e=this[t],null!=e.rotate&&null!=e.draw&&n.push(t));return n},add:function(t,n,r,i){var s;return null==i&&(i=null),s=this[t]=u.isFunction(r)?{rotate:n,draw:r}:{rotate:n,img:r,draw:function(t){return e(t,.5,.5,1,this.img)}},null==s.img||s.rotate||(s.shortcut=function(t,n,r,i){return e(t,n,r,i,this.img)}),null!=i?s.shortcut=i:void 0},poly:s,circ:n,ccirc:t,cimg:e,csq:r,spriteSheets:o,draw:function(t,e,n,r,i,s,o){return null!=e.shortcut?(null==e.img&&(t.fillStyle=u.colorStr(o)),e.shortcut(t,n,r,i)):(t.save(),t.translate(n,r),1!==i&&t.scale(i,i),0!==s&&t.rotate(s),null!=e.img?e.draw(t):(t.fillStyle=u.colorStr(o),t.beginPath(),e.draw(t),t.closePath(),t.fill()),t.restore()),e},drawSprite:function(t,e,n,r,i,s){return 0===s?t.drawImage(e.ctx.canvas,e.x,e.y,e.size,e.size,n-i/2,r-i/2,i,i):(t.save(),t.translate(n,r),t.rotate(s),t.drawImage(e.ctx.canvas,e.x,e.y,e.size,e.size,-i/2,-i/2,i,i),t.restore()),e},shapeToSprite:function(t,e,n){var r,s,a,h,l,c,p;if(n=Math.ceil(n),h=this[t],r=o[n],null==r&&(o[n]=r=u.createCtx(10*n,n),r.nextX=0,r.nextY=0,r.images={}),n*r.nextX===r.canvas.width&&(u.resizeCtx(r,r.canvas.width,r.canvas.height+n),r.nextX=0,r.nextY++),c=n*r.nextX,p=n*r.nextY,l={ctx:r,x:c,y:p,size:n,name:t,color:e},null!=(s=h.img)){if(null!=(a=r.images[t]))return a;r.images[t]=l,s.onload=function(){return i(l,s)}}else r.save(),r.scale(n,n),r.translate(r.nextX+.5,r.nextY+.5),r.fillStyle=u.colorStr(e),r.beginPath(),h.draw(r),r.closePath(),r.fill(),r.restore();return r.nextX++,l}}}(),ABM.AgentSet=function(_super){function AgentSet(){AgentSet.__super__.constructor.call(this),this.ID=0}return __extends(AgentSet,_super),AgentSet.asSet=function(t,e){var n;return null==e&&(e=ABM.AgentSet),t.__proto__=null!=(n=e.prototype)?n:e.constructor.prototype,t},AgentSet.prototype.add=function(t){return t.id=this.ID++,this.push(t),t},AgentSet.prototype.remove=function(t){var e;return 0===this.length&&u.error("remove: empty arraySet"),t===this.last()?this[--this.length]=null:(-1!==(e=this.indexOfID(t.id))&&this.splice(e,1),-1===e&&u.error("remove: indexOfID not in list")),this},AgentSet.prototype.uniq=function(){return u.uniq(this)},AgentSet.prototype.withID=function(t){var e;return-1!==(e=this.indexOfID(t))?this[e]:null},AgentSet.prototype.indexOfID=function(t,e){return null==e&&(e=!0),e||this.sortById(),t===this.last().id?this.length-1:u.binarySearch(this,t,function(t){return t.id})},AgentSet.prototype.asSet=function(t){return ABM.AgentSet.asSet(t)},AgentSet.prototype.asOrderedSet=function(t){return this.asSet(t).sortById()},AgentSet.prototype.toString=function(){var t;return"["+function(){var e,n,r;for(r=[],e=0,n=this.length;n>e;e++)t=this[e],r.push(""+t);return r}.call(this).join(", ")+"]"},AgentSet.prototype.getProp=function(t){var e,n,r,i;for(i=[],n=0,r=this.length;r>n;n++)e=this[n],i.push(e[t]);return i},AgentSet.prototype.getProps=function(t){var e,n,r,i,s;for(u.isString(t)&&(t=t.split(" ")),s=[],r=0,i=this.length;i>r;r++)e=this[r],s.push(function(){var r,i,s;for(s=[],r=0,i=t.length;i>r;r++)n=t[r],s.push(e[n]);return s}());return s},AgentSet.prototype.getPropWith=function(t,e){var n;return this.asSet(function(){var r,i,s;for(s=[],r=0,i=this.length;i>r;r++)n=this[r],n[t]===e&&s.push(n);return s}.call(this))},AgentSet.prototype.setProp=function(t,e){var n,r,i;for(r=0,i=this.length;i>r;r++)n=this[r],n[t]=e;return this},AgentSet.prototype.maxProp=function(t){return Math.max.apply(Math,this.getProp(t))},AgentSet.prototype.minProp=function(t){return Math.min.apply(Math,this.getProp(t))},AgentSet.prototype.shuffle=function(){return u.shuffle(this)},AgentSet.prototype.sortById=function(){return u.sortBy(this,"id")},AgentSet.prototype.clone=function(){return this.asSet(u.clone(this))},AgentSet.prototype.last=function(){return u.last(this)},AgentSet.prototype.any=function(){return u.any(this)},AgentSet.prototype.other=function(t){var e;return this.asSet(function(){var n,r,i;for(i=[],n=0,r=this.length;r>n;n++)e=this[n],e!==t&&i.push(e);return i}.call(this))},AgentSet.prototype.oneOf=function(){return u.oneOf(this)},AgentSet.prototype.nOf=function(t){return this.asSet(u.nOf(this,t))},AgentSet.prototype.minOneOf=function(t,e){return null==e&&(e=!1),u.minOneOf(this,t,e)},AgentSet.prototype.maxOneOf=function(t,e){return null==e&&(e=!1),u.maxOneOf(this,t,e)},AgentSet.prototype.draw=function(t){var e,n,r;for(u.clearCtx(t),n=0,r=this.length;r>n;n++)e=this[n],e.hidden||e.draw(t);return null},AgentSet.prototype.inRadius=function(t,e,n){var r,i,s,o,a,h;return null==n&&(n=!1),i=e*e,a=t.x,h=t.y,ABM.patches.isTorus?(o=ABM.patches.numX,s=ABM.patches.numY,this.asSet(function(){var e,l,c;for(c=[],e=0,l=this.length;l>e;e++)r=this[e],i>=u.torusSqDistance(a,h,r.x,r.y,o,s)&&(n||r!==t)&&c.push(r);return c}.call(this))):this.asSet(function(){var e,s,o;for(o=[],e=0,s=this.length;s>e;e++)r=this[e],i>=u.sqDistance(a,h,r.x,r.y)&&(n||r!==t)&&o.push(r);return o}.call(this))},AgentSet.prototype.inCone=function(t,e,n,r,i){var s,o,a,h,l,c;return null==i&&(i=!1),a=this.inRadius(t,r,i),l=t.x,c=t.y,ABM.patches.isTorus?(h=ABM.patches.numX,o=ABM.patches.numY,this.asSet(function(){var p,f,d;for(d=[],p=0,f=a.length;f>p;p++)s=a[p],(s===t&&i||u.inTorusCone(e,n,r,l,c,s.x,s.y,h,o))&&d.push(s);return d}())):this.asSet(function(){var o,h,p;for(p=[],o=0,h=a.length;h>o;o++)s=a[o],(s===t&&i||u.inCone(e,n,r,l,c,s.x,s.y))&&p.push(s);return p}())},AgentSet.prototype.ask=function(f){var o,_i,_len;for(u.isString(f)&&eval("f=function(o){return "+f+";}"),_i=0,_len=this.length;_len>_i;_i++)o=this[_i],f(o);return this},AgentSet.prototype["with"]=function(f){var o;return u.isString(f)&&eval("f=function(o){return "+f+";}"),this.asSet(function(){var t,e,n;for(n=[],t=0,e=this.length;e>t;t++)o=this[t],f(o)&&n.push(o);return n}.call(this))},AgentSet}(Array),XY=function(){function t(t,e){this.x=t,this.y=e}return t.prototype.toString=function(){return"{id:"+this.id+",x:"+this.x+",y:"+this.y+"}"},t}(),this.AS=new ABM.AgentSet,_ref=[[0,1],[8,0],[6,4],[1,3],[1,1]],_i=0,_len=_ref.length;_len>_i;_i++)pt=_ref[_i],AS.add(function(t,e,n){n.prototype=t.prototype;var r=new n,i=t.apply(r,e);return Object(i)===i?i:r}(XY,pt,function(){}));ABM.Patch=function(){function t(t,e){this.x=t,this.y=e}return t.prototype.n=null,t.prototype.n4=null,t.prototype.color=[0,0,0],t.prototype.hidden=!1,t.prototype.toString=function(){return"{id:"+this.id+" xy:"+u.aToFixed([this.x,this.y])+" c:"+this.color+"}"},t.prototype.scaleColor=function(t,e){return this.hasOwnProperty("color")||(this.color=u.clone(this.color)),u.scaleColor(t,e,this.color)},t.prototype.draw=function(t){var e,n,r;return t.fillStyle=u.colorStr(this.color),t.fillRect(this.x-.5,this.y-.5,1,1),null!=this.label?(r=t.labelXY,e=r[0],n=r[1],t.save(),t.translate(this.x,this.y),t.scale(1/ABM.patches.size,-1/ABM.patches.size),u.ctxDrawText(t,this.label,[e,n],t.labelColor),t.restore()):void 0},t.prototype.agentsHere=function(){var t,e;return null!=(e=this.agents)?e:function(){var e,n,r,i;for(r=ABM.agents,i=[],e=0,n=r.length;n>e;e++)t=r[e],t.p===this&&i.push(t);return i}.call(this)},t.prototype.isOnEdge=function(){return this.x===ABM.patches.minX||this.x===ABM.patches.maxX||this.y===ABM.patches.minY||this.y===ABM.patches.maxY},t.prototype.sprout=function(t,e,n){var r=this;return null==t&&(t=1),null==e&&(e=ABM.agents),null==n&&(n=function(){}),e.create(t,function(t){return t.setXY(r.x,r.y),n(t),t})},t}(),ABM.Patches=function(t){function e(t,n,r,i,s,o,a){var u,h,l,c;for(this.size=t,this.minX=n,this.maxX=r,this.minY=i,this.maxY=s,this.isTorus=null!=o?o:!0,null==a&&(a=!0),e.__super__.constructor.call(this),this.numX=this.maxX-this.minX+1,this.numY=this.maxY-this.minY+1,h=l=i;s>=l;h=l+=1)for(u=c=n;r>=c;u=c+=1)this.add(new ABM.Patch(u,h));a&&this.setNeighbors(),this.setPixels(),this.drawWithPixels=1===this.size}return __extends(e,t),e.prototype.setDefaultColor=function(t){return ABM.Patch.prototype.color=t},e.prototype.setDefaultVariable=function(t,e){return ABM.Patch.prototype[t]=e},e.prototype.setNeighbors=function(){var t,e,n,r,i;for(i=[],n=0,r=this.length;r>n;n++)e=this[n],e.n=this.patchRect(e,1,1),i.push(e.n4=this.asSet(function(){var n,r,i,s;for(i=e.n,s=[],n=0,r=i.length;r>n;n++)t=i[n],(t.x===e.x||t.y===e.y)&&s.push(t);return s}()));return i},e.prototype.setPixels=function(){var t;return 1===this.size?this.pixelsCtx=ABM.contexts.patches:(t=document.createElement("canvas"),t.width=this.numX,t.height=this.numY,this.pixelsCtx=t.getContext("2d")),this.pixelsImageData=this.pixelsCtx.getImageData(0,0,this.numX,this.numY),this.pixelsData=this.pixelsImageData.data,this.pixelsData instanceof Uint8Array?(this.pixelsData32=new Uint32Array(this.pixelsData.buffer),this.pixelsAreLittleEndian=u.isLittleEndian()):void 0},e.prototype.draw=function(t){return this.drawWithPixels?this.drawScaledPixels(t):e.__super__.draw.call(this,t)},e.prototype.patchXY=function(t,e){return this[t-this.minX+this.numX*(e-this.minY)]},e.prototype.clamp=function(t,e){return[u.clamp(t,this.minX-.5,this.maxX+.5),u.clamp(e,this.minY-.5,this.maxY+.5)]},e.prototype.wrap=function(t,e){return[u.wrap(t,this.minX-.5,this.maxX+.5),u.wrap(e,this.minY-.5,this.maxY+.5)]},e.prototype.coord=function(t,e){return this.isTorus?this.wrap(t,e):this.clamp(t,e)},e.prototype.patch=function(t,e){var n;return n=this.coord(t,e),t=n[0],e=n[1],t=u.clamp(Math.round(t),this.minX,this.maxX),e=u.clamp(Math.round(e),this.minY,this.maxY),this.patchXY(t,e)},e.prototype.randomPt=function(){return[u.randomFloat2(this.minX-.5,this.maxX+.5),u.randomFloat2(this.minY-.5,this.maxY+.5)]},e.prototype.bitWidth=function(){return this.numX*this.size},e.prototype.bitHeight=function(){return this.numY*this.size},e.prototype.patches2Bits=function(t){return t*this.size},e.prototype.bits2Patches=function(t){return t/this.size},e.prototype.patchRect=function(t,e,n,r){var i,s,o,a,h,l,c,p,f,d;if(null==r&&(r=!1),null!=t.pRect&&t.pRect.radius===e&&t.pRect.radius===n)return t.pRect;for(s=[],a=h=c=t.y-n,p=t.y+n;p>=h;a=h+=1)for(o=l=f=t.x-e,d=t.x+e;d>=l;o=l+=1)(this.isTorus||o>=this.minX&&this.maxX>=o&&a>=this.minY&&this.maxY>=a)&&(this.isTorus&&(this.minX>o&&(o+=this.numX),o>this.maxX&&(o-=this.numX),this.minY>a&&(a+=this.numY),a>this.maxY&&(a-=this.numY)),i=this.patchXY(o,a),null==i&&(u.error("patchRect: x,y out of bounds, see console.log"),console.log("  x "+o+" y "+a+" p.x "+t.x+" p.y "+t.y+" dx "+e+" dy "+n+" minX "+this.minX+" minY "+this.minY)),(r||t!==i)&&s.push(i));return this.asSet(s)},e.prototype.importDrawing=function(t){return u.importImage(t,function(t){var e;return e=ABM.drawing,e.save(),e.setTransform(1,0,0,1,0,0),e.drawImage(t,0,0,e.canvas.width,e.canvas.height),e.restore()})},e.prototype.pixelIndex=function(t){return 4*(t.x-this.minX+(this.maxY-t.y)*this.numX)},e.prototype.importColors=function(t){var e=this;return u.importImage(t,function(t){var n,r,i,s,o,a;for(t.width!==e.numX||t.height!==e.numY?e.pixelsCtx.drawImage(t,0,0,e.numX,e.numY):e.pixelsCtx.drawImage(t,0,0),n=e.pixelsCtx.getImageData(0,0,e.numX,e.numY).data,o=0,a=e.length;a>o;o++)s=e[o],r=e.pixelIndex(s),s.color=function(){var t,e;for(e=[],i=t=0;2>=t;i=++t)e.push(n[r+i]);return e}();return null})},e.prototype.drawScaledPixels=function(t){return null!=this.pixelsData32?this.drawScaledPixels32(t):this.drawScaledPixels8(t)},e.prototype.drawScaledPixels8=function(t){var e,n,r,i,s,o,a,u,h,l,c;for(n=this.pixelsData,o=this.minX,a=this.numX,s=this.maxY,h=0,c=this.length;c>h;h++){for(u=this[h],r=4*(u.x-o+(s-u.y)*a),e=u.color,i=l=0;2>=l;i=++l)n[r+i]=e[i];n[r+3]=4===e.length?e[3]:255}return this.pixelsCtx.putImageData(this.pixelsImageData,0,0),1!==this.size?t.drawImage(this.pixelsCtx.canvas,0,0,t.canvas.width,t.canvas.height):void 0},e.prototype.drawScaledPixels32=function(t){var e,n,r,i,s,o,a,u,h,l;for(r=this.pixelsData32,o=this.minX,a=this.numX,s=this.maxY,h=0,l=this.length;l>h;h++)u=this[h],i=u.x-o+(s-u.y)*a,n=u.color,e=4===n.length?n[3]:255,r[i]=this.pixelsAreLittleEndian?e<<24|n[2]<<16|n[1]<<8|n[0]:n[0]<<24|n[1]<<16|n[2]<<8|e;return this.pixelsCtx.putImageData(this.pixelsImageData,0,0),1!==this.size?t.drawImage(this.pixelsCtx.canvas,0,0,t.canvas.width,t.canvas.height):void 0},e.prototype.diffuse=function(t,e,n){var r,i,s,o,a,u,h,l,c,p,f,d,m,g;if(null==n&&(n=null),null==this[0]._diffuseNext)for(u=0,c=this.length;c>u;u++)a=this[u],a._diffuseNext=0;for(h=0,p=this.length;p>h;h++)for(a=this[h],r=a[t]*e,i=r/8,o=a.n.length,a._diffuseNext+=a[t]-r+(8-o)*i,g=a.n,l=0,f=g.length;f>l;l++)s=g[l],s._diffuseNext+=i;for(m=0,d=this.length;d>m;m++)a=this[m],a[t]=a._diffuseNext,a._diffuseNext=0,n&&a.scaleColor(n,a[t]);return null},e}(ABM.AgentSet),ABM.Agent=function(){function t(){this.x=this.y=0,null==this.color&&(this.color=u.randomColor()),null==this.heading&&(this.heading=u.randomFloat(2*Math.PI)),this.p=ABM.patches.patch(this.x,this.y),null!=this.p.agents&&this.p.agents.push(this),ABM.links.cacheAgentLinks&&(this.links=[])}return t.prototype.color=null,t.prototype.shape="default",t.prototype.breed=null,t.prototype.hidden=!1,t.prototype.size=1,t.prototype.penDown=!1,t.prototype.penSize=1,t.prototype.heading=null,t.prototype.sprite=null,t.prototype.links=null,t.prototype.ownVariables=[],t.prototype.changeBreed=function(t){var e=this;return null==this.id&&u.error("changeBreed: not in agentSet"),this.hasOwnProperty("breed")&&u.error("changeBreed: breed illegally set"),this.breed===t&&u.error("changeBreed: breed==newBreed"),this.die(),t.create(1,function(t){return t.setXY(e.x,e.y)})},t.prototype.scaleColor=function(t,e){return this.hasOwnProperty("color")||(this.color=u.clone(this.color)),u.scaleColor(t,e,this.color)},t.prototype.toString=function(){return"{id:"+this.id+" xy:"+u.aToFixed([this.x,this.y])+" c:"+this.color+" h: "+this.heading.toFixed(2)+"}"},t.prototype.setXY=function(t,e){var n,r,i,s,o,a;return this.penDown&&(o=[this.x,this.y],i=o[0],s=o[1]),a=ABM.patches.coord(t,e),this.x=a[0],this.y=a[1],r=this.p,this.p=ABM.patches.patch(this.x,this.y),null!=r.agents&&r!==this.p&&(u.removeItem(r.agents,this),this.p.agents.push(this)),this.penDown?(n=ABM.drawing,n.strokeStyle=u.colorStr(this.color),n.lineWidth=ABM.patches.bits2Patches(this.penSize),n.beginPath(),n.moveTo(i,s),n.lineTo(t,e),n.stroke()):void 0},t.prototype.moveTo=function(t){return this.setXY(t.x,t.y)},t.prototype.forward=function(t){return this.setXY(this.x+t*Math.cos(this.heading),this.y+t*Math.sin(this.heading))},t.prototype.rotate=function(t){return this.heading=u.wrap(this.heading+t,0,2*Math.PI)},t.prototype.draw=function(t){var e,n;return n=ABM.shapes[this.shape],e=n.rotate?this.heading:0,null!=this.sprite?ABM.shapes.drawSprite(t,this.sprite,this.x,this.y,this.size,e):ABM.shapes.draw(t,n,this.x,this.y,this.size,e,this.color)},t.prototype.stamp=function(){return this.draw(ABM.drawing)},t.prototype.distanceXY=function(t,e){return ABM.patches.isTorus?u.torusDistance(this.x,this.y,t,e,ABM.patches.numX,ABM.patches.numY):u.distance(this.x,this.y,t,e)},t.prototype.distance=function(t){return this.distanceXY(t.x,t.y)},t.prototype.torusPtXY=function(t,e){return u.torusPt(this.x,this.y,t,e,ABM.patches.numX,ABM.patches.numY)},t.prototype.torusPt=function(t){return this.torusPtXY(t.x,t.y)},t.prototype.face=function(t){return this.heading=this.towards(t)},t.prototype.towardsXY=function(t,e){return ABM.patches.isTorus?u.torusRadsToward(this.x,this.y,t,e,ABM.patches.numX,ABM.patches.numY):u.radsToward(this.x,this.y,t,e)},t.prototype.towards=function(t){return this.towardsXY(t.x,t.y)},t.prototype.die=function(){var t,e,n,r;for(this.breed.remove(this),r=this.myLinks(),e=0,n=r.length;n>e;e++)t=r[e],t.die();return null!=this.p.agents&&u.removeItem(this.p.agents,this),null},t.prototype.hatch=function(t,e,n){var r=this;return null==t&&(t=1),null==e&&(e=ABM.agents),null==n&&(n=function(){}),e.create(t,function(t){var e,i;t.setXY(r.x,r.y);for(e in r)__hasProp.call(r,e)&&(i=r[e],"id"!==e&&(t[e]=i));return n(t),t})},t.prototype.inCone=function(t,e,n,r){return null==r&&(r=!1),t.inCone(this.p,this.heading,e,n,r)},t.prototype.otherEnd=function(t){return t.end1===this?t.end2:t.end1},t.prototype.myLinks=function(){var t,e;return null!=(e=this.links)?e:function(){var e,n,r,i;for(r=ABM.links,i=[],e=0,n=r.length;n>e;e++)t=r[e],(t.end1===this||t.end2===this)&&i.push(t);return i}.call(this)},t.prototype.linkNeighbors=function(){var t,e,n,r,i;for(r=this.myLinks(),i=[],e=0,n=r.length;n>e;e++)t=r[e],i.push(this.otherEnd(t));return i},t.prototype.myInLinks=function(){var t,e,n,r,i;for(r=this.myLinks(),i=[],e=0,n=r.length;n>e;e++)t=r[e],t.end2===this&&i.push(t);return i},t.prototype.inLinkNeighbors=function(){var t,e,n,r,i;for(r=this.myLinks(),i=[],e=0,n=r.length;n>e;e++)t=r[e],t.end2===this&&i.push(t.end1);return i},t.prototype.myOutLinks=function(){var t,e,n,r,i;for(r=this.myLinks(),i=[],e=0,n=r.length;n>e;e++)t=r[e],t.end1===this&&i.push(t);return i},t.prototype.outLinkNeighbors=function(){var t,e,n,r,i;for(r=this.myLinks(),i=[],e=0,n=r.length;n>e;e++)t=r[e],t.end1===this&&i.push(t.end2);return i},t}(),ABM.Agents=function(t){function e(t,n,r){this.breedClass=t,this.name=n,this.mainSet=null!=r?r:null,e.__super__.constructor.call(this),this.useSprites=!1,this.breedClass.prototype.breed=this,null!=this.mainSet&&delete this.ID}return __extends(e,t),e.prototype.setDefaultColor=function(t){return this.breedClass.prototype.color=t},e.prototype.setDefaultShape=function(t){return this.breedClass.prototype.shape=t},e.prototype.setDefaultSize=function(t){return this.breedClass.prototype.size=t},e.prototype.setDefaultHeading=function(t){return this.breedClass.prototype.heading=t},e.prototype.setDefaultHidden=function(t){return this.breedClass.prototype.hidden=t},e.prototype.setDefaultSprite=function(){return null!=this.breedClass.prototype.color?this.breedClass.prototype.sprite=ABM.shapes.shapeToSprite(this.breedClass.prototype.shape,this.breedClass.prototype.color,this.breedClass.prototype.size*ABM.patches.size):void 0},e.prototype.setDefaultPen=function(t,e){return null==e&&(e=!1),this.breedClass.prototype.penSize=t,this.breedClass.prototype.penDown=e},e.prototype.setDefaultVariable=function(t,e){return"string"!=typeof t&&u.error("setDefaultVariable: name is not a string"),this.breedClass.prototype[t]=e,this.breedClass.prototype.ownVariables.push(t)},e.prototype.setUseSprites=function(t){this.useSprites=null!=t?t:!0},e.prototype.own=function(){var t,e,n,r,i,s,o;for(e=arguments[0],r=arguments[1],n=arguments.length>=3?__slice.call(arguments,2):[],this.setDefaultVariable(e,r),0!==n.length%2&&u.error("own: odd number of arguments"),o=[],t=i=0,s=n.length;s>i;t=i+=2)e=n[t],o.push(this.setDefaultVariable(e,n[t+1]));return o},e.prototype.add=function(t){return null!=this.mainSet?(this.mainSet.add(t),this.push(t)):e.__super__.add.call(this,t),t},e.prototype.remove=function(t){return e.__super__.remove.call(this,t),null!=this.mainSet?this.mainSet.remove(t):void 0},e.prototype["in"]=function(t){var e;return this.asSet(function(){var n,r,i;for(i=[],n=0,r=t.length;r>n;n++)e=t[n],e.breed===this&&i.push(e);return i}.call(this))},e.prototype.create=function(t,e){var n,r,i;for(null==e&&(e=function(){}),i=[],n=r=1;t>=r;n=r+=1)i.push(function(t){return e(t),t}(this.add(new this.breedClass)));return i},e.prototype.clear=function(){for(;this.any();)this.last().die();return null},e.prototype.inPatches=function(t){var e,n,r,i;for(e=[],r=0,i=t.length;i>r;r++)n=t[r],e.push.apply(e,n.agentsHere());return null!=this.mainSet?this["in"](e):this.asSet(e)},e.prototype.inRect=function(t,e,n,r){var i;return null==r&&(r=!1),i=ABM.patches.patchRect(t.p,e,n,!0),i=this.inPatches(i),r||u.removeItem(i,t),i},e.prototype.inCone=function(t,e,n,r,i){var s;return null==i&&(i=!1),s=this.inRect(t,r,r,!0),s.inCone(t,e,n,r,i)},e.prototype.inRadius=function(t,e,n){var r;return null==n&&(n=!1),r=this.inRect(t,e,e,!0),r.inRadius(t,e,n)},e}(ABM.AgentSet),ABM.Link=function(){function t(t,e){this.end1=t,this.end2=e,ABM.links.cacheAgentLinks&&(this.end1.links.push(this),this.end2.links.push(this))}return t.prototype.breed=null,t.prototype.color=[130,130,130],t.prototype.thickness=2,t.prototype.hidden=!1,t.prototype.draw=function(t){return t.save(),t.strokeStyle=u.colorStr(this.color),t.lineWidth=ABM.patches.bits2Patches(this.thickness),t.beginPath(),ABM.patches.isTorus?(pt=this.end1.torusPt(this.end2),t.moveTo(this.end1.x,this.end1.y),t.lineTo.apply(t,pt),(pt[0]!==this.end2.x||pt[1]!==this.end2.y)&&(pt=this.end2.torusPt(this.end1),t.moveTo(this.end2.x,this.end2.y),t.lineTo.apply(t,pt))):(t.moveTo(this.end1.x,this.end1.y),t.lineTo(this.end2.x,this.end2.y)),t.closePath(),t.stroke(),t.restore()},t.prototype.die=function(){return this.breed.remove(this),null!=this.end1.links&&u.removeItem(this.end1.links,this),null!=this.end2.links&&u.removeItem(this.end2.links,this),null},t.prototype.bothEnds=function(){return[this.end1,this.end2]},t.prototype.length=function(){return this.end1.distance(this.end2)},t.prototype.otherEnd=function(t){return this.end1===t?this.end2:this.end1},t}(),ABM.Links=function(t){function e(t,n,r){this.breedClass=t,this.name=n,this.mainSet=null!=r?r:null,e.__super__.constructor.call(this),this.cacheAgentLinks=!1,this.breedClass.prototype.breed=this
}return __extends(e,t),e.prototype.setDefaultColor=function(t){return this.breedClass.prototype.color=t},e.prototype.setDefaultThickness=function(t){return this.breedClass.prototype.thickness=t},e.prototype.setDefaultHidden=function(t){return this.breedClass.prototype.hidden=t},e.prototype.setDefaultVariable=function(t,e){return this.breedClass.prototype[t]=e},e.prototype.add=function(t){return null!=this.mainSet?(this.mainSet.add(t),this.push(t)):e.__super__.add.call(this,t),t},e.prototype.remove=function(t){return e.__super__.remove.call(this,t),null!=this.mainSet?this.mainSet.remove(t):void 0},e.prototype.create=function(t,e,n){var r,i,s,o;for(null==n&&(n=function(){}),null==e.length&&(e=[e]),o=[],i=0,s=e.length;s>i;i++)r=e[i],o.push(function(t){return n(t),t}(this.add(new this.breedClass(t,r))));return o},e.prototype.clear=function(){for(;this.any();)this.last().die();return null},e.prototype.allEnds=function(){var t,e,n,r;for(e=this.asSet([]),n=0,r=this.length;r>n;n++)t=this[n],e.push(t.end1,t.end2);return e},e.prototype.nodes=function(){return this.allEnds().sortById().uniq()},e.prototype.layoutCircle=function(t,e,n,r){var i,s,o,a,u;for(null==n&&(n=Math.PI/2),null==r&&(r=-1),s=2*Math.PI/t.length,o=a=0,u=t.length;u>a;o=++a)i=t[o],i.setXY(0,0),i.heading=n+r*s*o,i.forward(e);return null},e}(ABM.AgentSet),ABM.Animator=function(){function t(t,e,n){this.model=t,this.rate=null!=e?e:30,this.multiStep=null!=n?n:!1,this.animateDraws=__bind(this.animateDraws,this),this.animateSteps=__bind(this.animateSteps,this),this.ticks=this.draws=0,this.animHandle=this.timerHandle=this.intervalHandle=null,this.animStop=!0}return t.prototype.setRate=function(t,e){return this.rate=t,this.multiStep=null!=e?e:!1,this.reset()},t.prototype.start=function(){return this.animStop?(this.reset(),this.animStop=!1,this.animate()):void 0},t.prototype.reset=function(){return this.startMS=this.now(),this.startTick=this.ticks,this.startDraw=this.draws},t.prototype.stop=function(){return this.animStop=!0,null!=this.animHandle&&cancelAnimFrame(this.animHandle),null!=this.timeoutHandle&&clearTimeout(this.timeoutHandle),null!=this.intervalHandle&&clearInterval(this.intervalHandle),this.animHandle=this.timerHandle=this.intervalHandle=null},t.prototype.step=function(){return this.ticks++,this.model.step()},t.prototype.draw=function(){return this.draws++,this.model.draw()},t.prototype.once=function(){return this.step(),this.draw()},t.prototype.now=function(){return("undefined"!=typeof performance&&null!==performance?performance:Date).now()},t.prototype.ms=function(){return this.now()-this.startMS},t.prototype.ticksPerSec=function(){var t;return 0===(t=this.ticks-this.startTick)?0:Math.round(1e3*t/this.ms())},t.prototype.drawsPerSec=function(){var t;return 0===(t=this.draws-this.startDraw)?0:Math.round(1e3*t/this.ms())},t.prototype.toString=function(){return"ticks: "+this.ticks+", draws: "+this.draws+", rate: "+this.rate+" "+this.ticksPerSec()+"/"+this.drawsPerSec()},t.prototype.animateSteps=function(){return this.step(),this.animStop?void 0:this.timeoutHandle=setTimeout(this.animateSteps,10)},t.prototype.animateDraws=function(){return this.drawsPerSec()<=this.rate&&(this.multiStep||this.step(),this.draw()),this.animStop?void 0:this.animHandle=requestAnimFrame(this.animateDraws)},t.prototype.animate=function(){return this.multiStep&&this.animateSteps(),this.animateDraws()},t}(),ABM.Model=function(){function t(t,e,n,r,i,s,o,a){var h,l,c,p,f,d,m,g;null==o&&(o=!0),null==a&&(a=!0),ABM.model=this,this.contexts=ABM.contexts={},m=this.contextsInit;for(c in m)__hasProp.call(m,c)&&(p=m[c],this.contexts[c]=l=u.createLayer(t,e*(r-n+1),e*(s-i+1),p.z,p.ctx),l.save(),l.scale(e,-e),l.translate(-(n-.5),-(s+.5)),l.agentSetName=c);if(this.patches=ABM.patches=new ABM.Patches(e,n,r,i,s,o,a),this.agents=ABM.agents=new ABM.Agents(ABM.Agent,"agents"),this.links=ABM.links=new ABM.Links(ABM.Link,"links"),this.drawing=ABM.drawing=this.contexts.drawing,this.contexts.spotlight.globalCompositeOperation="xor",this.anim=new ABM.Animator(this),this.refreshLinks=this.refreshAgents=this.refreshPatches=!0,this.fastPatches=!1,this.setup(),this.agents.useSprites)for(this.agents.setDefaultSprite(),g=this.agents,f=0,d=g.length;d>f;f++)h=g[f],h.hasOwnProperty("sprite")||h.hasOwnProperty("color")&&(h.sprite=ABM.shapes.shapeToSprite(h.shape,h.color,h.size*this.patches.size))}return t.prototype.contextsInit={patches:{z:0,ctx:"2d"},drawing:{z:1,ctx:"2d"},links:{z:2,ctx:"2d"},agents:{z:3,ctx:"2d"},spotlight:{z:4,ctx:"2d"}},t.prototype.setFastPatches=function(){var t;return t=this.contexts.patches,t.imageSmoothingEnabled=!1,t.mozImageSmoothingEnabled=!1,t.webkitImageSmoothingEnabled=!1,t.save(),t.setTransform(1,0,0,1,0,0),this.patches.drawWithPixels=!0},t.prototype.setCacheAgentsHere=function(){var t,e,n,r,i,s,o,a,u;for(o=this.patches,n=0,i=o.length;i>n;n++)e=o[n],e.agents=[];for(a=this.agents,u=[],r=0,s=a.length;s>r;r++)t=a[r],u.push(t.p.agents.push(t));return u},t.prototype.setCacheMyLinks=function(){var t,e,n,r,i,s,o,a,u;for(this.links.cacheAgentLinks=!0,o=this.agents,n=0,i=o.length;i>n;n++)t=o[n],t.links=[];for(a=this.links,u=[],r=0,s=a.length;s>r;r++)e=a[r],u.push((e.end1.links.push(e),e.end2.links.push(e)));return u},t.prototype.setCachePatchRects=function(t,e){var n,r,i,s,o;for(null==e&&(e=!1),s=this.patches,o=[],r=0,i=s.length;i>r;r++)n=s[r],n.pRect=this.patches.patchRect(n,t,t,e),n.pRect.radius=t,o.push(n.pRect.meToo=e);return o},t.prototype.agentSetCtxName=function(t){return null!=t.mainSet&&(t=t.mainSet),t.constructor.name.toLowerCase()},t.prototype.setTextParams=function(t,e,n,r){return null==n&&(n="center"),null==r&&(r="middle"),"string"!=typeof t&&(t=this.agentSetCtxName(t)),null==this.contexts[t]&&u.error("setTextParams: "+this.agentSetName+" not fount."),u.ctxTextParams(this.contexts[t],e,n,r)},t.prototype.setLabelParams=function(t,e,n){return"string"!=typeof t&&(t=this.agentSetCtxName(t)),null==this.contexts[t]&&u.error("setLabelParams: "+this.agentSetName+" not fount."),u.ctxLabelParams(this.contexts[t],e,n)},t.prototype.setup=function(){},t.prototype.step=function(){},t.prototype.start=function(){return this.anim.start()},t.prototype.stop=function(){return this.anim.stop()},t.prototype.once=function(){return this.anim.once()},t.prototype.draw=function(){return(this.refreshPatches||1===this.anim.draws)&&this.patches.draw(this.contexts.patches),(this.refreshLinks||1===this.anim.draws)&&this.links.draw(this.contexts.links),(this.refreshAgents||1===this.anim.draws)&&this.agents.draw(this.contexts.agents),null!=this.spotlightAgent?this.drawSpotlight(this.spotlightAgent,this.contexts.spotlight):void 0},t.prototype.setSpotlight=function(t){return this.spotlightAgent=t,null==this.spotlightAgent?u.clearCtx(this.contexts.spotlight):void 0},t.prototype.drawSpotlight=function(t,e){return u.clearCtx(e),u.fillCtx(e,[0,0,0,.6]),e.beginPath(),e.arc(t.x,t.y,3,0,2*Math.PI,!1),e.fill()},t.prototype.createBreeds=function(t,e,n){var r,i,s,o,a,u,h;for(s=[],s.classes={},s.sets={},h=t.split(" "),a=0,u=h.length;u>a;a++)i=h[a],o=r=function(t){function e(){e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e}(e),o.prototype.name=i,this[i]=new n(o,i,e.prototype.breed),s.push(this[i]),s.sets[i]=this[i],s.classes[""+i+"Class"]=o;return s},t.prototype.agentBreeds=function(t){return ABM.agentBreeds=this.createBreeds(t,ABM.Agent,ABM.Agents)},t.prototype.linkBreeds=function(t){return ABM.linkBreeds=this.createBreeds(t,ABM.Link,ABM.Links)},t.prototype.asSet=function(t){return ABM.AgentSet.asSet(t)},t.prototype.setRootVars=function(){return ABM.root.ps=this.patches,ABM.root.p0=this.patches[0],ABM.root.as=this.agents,ABM.root.a0=this.agents[0],ABM.root.ls=this.links,ABM.root.l0=this.links[0],ABM.root.dr=this.drawing,ABM.root.u=ABM.util,ABM.root.sh=ABM.shapes,ABM.root.app=this,ABM.root.cx=this.contexts,ABM.root.ab=ABM.agentBreeds,ABM.root.lb=ABM.linkBreeds,ABM.root.an=this.anim,null},t}()}).call(this);