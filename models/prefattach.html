<html>
  <head>
    <title>CoffeeScript & Canvas ABM Test</title>
    <script src="../agentscript.js"></script>
    <script src="../coffee-script.js"></script>
    <script type="text/coffeescript">
    class MyModel extends ABM.Model
      u = ABM.util # utilities; static variable
      setup: -> # called by Model ctor
        @refreshPatches = false # for static patches
        
        # globals
        @circleLayout = true
        @agents.setDefaultShape "circle"
        @hist = []
        
        @agents.create 1; @makeNode @agents[0]
      step: ->
        @makeNode @findPartner()
        a.size = Math.sqrt a.linkNeighbors().length for a in @agents
        @links.layoutCircle @agents, @patches.maxX * 0.9
        @hist = u.histOf @agents, 1, (a) -> a.linkNeighbors().length
        if @ticks % 25 is 0 then console.log @hist

      makeNode: (toNode) ->
        @agents.create 1, (a) =>
          @links.create a, toNode
          a.moveTo toNode; a.forward 8
      findPartner: ->
        @links.oneOf().bothEnds().oneOf() # or @links.allEnds().oneOf()

    # divName, patchSize, minX, maxX, minY, maxY, isTorus = true
    #   NL Defaults: 13, -16, 16, -16, 16, true
    # @APP is window.APP, @ = outer coffeescript wrapper context
    @APP=new MyModel "layers", 5, -45, 45, -45, 45, false
    </script>

  </head>
  <body onload="APP.start()">
    <canvas id="testCanvas">Your browser does not support HTML5 Canvas.</canvas>
    <div id="layers"></div>
  </body>
</html>