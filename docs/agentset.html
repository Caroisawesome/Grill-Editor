<!DOCTYPE html>  <html> <head>   <title>agentset.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="agentset.html">                 agentset.coffee               </a>                                           <a class="source" href="agentsets.html">                 agentsets.coffee               </a>                                           <a class="source" href="model.html">                 model.coffee               </a>                                           <a class="source" href="shapes.html">                 shapes.coffee               </a>                                           <a class="source" href="template.html">                 template.coffee               </a>                                           <a class="source" href="util.html">                 util.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               agentset.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p><strong>AgentSet</strong> is a subclass of <code>Array</code> and is the base class for
<code>Patches</code>, <code>Agents</code>, and <code>Links</code>.  Its subclasses are also a factory
for agent classes (<code>Patch</code>, <code>Agent</code>, <code>Link</code>). <code>AgentSet</code> keeps track of all
the created agent instances.  It also provides, much like the <strong>ABM.util</strong>
module, many methods shared by all subclasses of AgentSet.</p>

<p>ABM contains three agentsets created by class Model:</p>

<ul>
<li><code>ABM.patches</code>: the model's "world" grid</li>
<li><code>ABM.agents</code>: the model's agents living on the patchs</li>
<li><code>ABM.links</code>: the network links connecting agent pairs</li>
</ul>

<p>See NetLogo <a href="http://ccl.northwestern.edu/netlogo/docs/">documentation</a>
for explanation on the overall semantics of Agent Based Modeling
used by AgentSets as well as Patches, Agents, and Links.</p>

<p>Note: subclassing <code>Array</code> can be dangerous and we may have to convert
to a different style. See Trevor Burnham's <a href="http://goo.gl/Lca8g">comments</a>
but thus far we've resolved all related problems, mainly by using the
ABM.util array functions rather than "super".</p>

<p>Because we are an array subset, @[i] below (this[i]), gets the i'th agentset element.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>The usual alias for <strong>ABM.util</strong>. These are equivalent:</p>

<pre><code> ABM.util.clearCtx(ctx)
 u.clearCtx(ctx)
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">u = </span><span class="nx">ABM</span><span class="p">.</span><span class="nx">util</span>

<span class="k">class</span> <span class="nx">ABM</span><span class="p">.</span><span class="nx">AgentSet</span> <span class="k">extends</span> <span class="nb">Array</span> </pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h3>Static members</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p><code>asSet</code> is a static wrapper function converting an array of agents into
an <code>AgentSet</code> .. except for the ID which only impacts the add method.
It is primarily used to turn a comprehension into an AgentSet instance
which then gains access to all the methods below.  Ex:</p>

<pre><code>evens = (a for a in ABM.agents when a.id % 2 is 0)
ABM.AgentSet.asSet(evens)
randomEven = evens.oneOf()
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="vi">@asSet: </span><span class="nf">(a, setType = ABM.AgentSet) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>if a.prototype?
then a.prototype = setType.prototype
else a.<strong>proto</strong> = setType.prototype</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">a.__proto__ = </span><span class="nx">setType</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">?</span> <span class="nx">setType</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">prototype</span> <span class="c1"># setType.__proto__</span>
    <span class="nx">a</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>In the examples below, we'll use an array of primitive agent objects
with three fields: id, x, y.</p>

<pre><code>AS = for i in [1..5] # long form comprehension
  {id:i, x:u.randomInt(10), y:u.randomInt(10)}
ABM.AgentSet.asSet AS # Convert AS to AgentSet in place
# .. produced
   [{id:1,x:0,y:1}, {id:2,x:8,y:0}, {id:3,x:6,y:4},
    {id:4,x:1,y:3}, {id:5,x:1,y:1}]
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <h3>Constructor and add/remove agents.</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Create an empty <code>AgentSet</code> and initialize the <code>ID</code> counter for add().</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">constructor: </span><span class="o">-&gt;</span>
    <span class="k">super</span><span class="p">()</span>
    <span class="vi">@ID = </span><span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Add an agent to the list.  Only used by agentset factory methods. Adds
the <code>id</code> and <code>hidden</code> properties to all agents. Increment <code>ID</code>.
Returns the object for chaining. The set will be sorted by <code>id</code>.</p>

<p>By "agent" we mean an instance of <code>Patch</code>, <code>Agent</code> and <code>Link</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">add: </span><span class="nf">(o) -&gt;</span>
    <span class="nv">o.id = </span><span class="nx">@ID</span><span class="o">++</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>o.hidden = false</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@push</span> <span class="nx">o</span><span class="p">;</span> <span class="nx">o</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Remove an agent from the agentset, returning the agentset.
Note this does not change ID, thus an
agentset can have gaps in terms of their id's. Assumes set is
sorted by <code>id</code>. If the set is one created by <code>asSet</code>, and the original
array is unsorted, simply call <code>sortById</code> first, see <code>sortById</code> below.</p>

<pre><code>AS.remove(AS[3]) # [{id:0,x:0,y:1}, {id:1,x:8,y:0},
                    {id:2,x:6,y:4}, {id:4,x:1,y:1}] 
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">remove: </span><span class="nf">(o) -&gt;</span>
    <span class="k">if</span> <span class="nx">o</span> <span class="o">is</span> <span class="nx">@last</span><span class="p">()</span>
      <span class="nx">@</span><span class="p">.</span><span class="nx">length</span><span class="o">--</span>
    <span class="k">else</span>
      <span class="nx">@splice</span> <span class="nx">i</span><span class="p">,</span> <span class="mi">1</span> <span class="k">if</span> <span class="p">(</span><span class="nv">i = </span><span class="nx">@indexOfID</span> <span class="nx">o</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span> <span class="o">isnt</span> <span class="o">-</span><span class="mi">1</span>
    <span class="nx">@</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Remove adjacent duplicates, by reference, in a sorted agentset.
Use <code>sortById</code> first if agentset not sorted.</p>

<pre><code>as = (AS.oneOf() for i in [1..4]) # 4 random agents w/ dups
ABM.AgentSet.asSet as # [{id:1,x:8,y:0}, {id:0,x:0,y:1},
                         {id:0,x:0,y:1}, {id:2,x:6,y:4}]
as.sortById().uniq() # [{id:0,x:0,y:1}, {id:1,x:8,y:0}, 
                        {id:2,x:6,y:4}]
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">uniq: </span><span class="o">-&gt;</span> <span class="nx">u</span><span class="p">.</span><span class="nx">uniq</span><span class="p">(</span><span class="nx">@</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Return the agent with the given <code>id</code> within the sorted agentset.
Uses binary search thus is faster than simple lookup.</p>

<pre><code>AS.withID 4 # {id:4,x:1,y:1}
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">withID: </span><span class="nf">(id) -&gt;</span> <span class="c1"># null if not found</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">i = </span><span class="nx">@indexOfID</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="o">isnt</span> <span class="o">-</span><span class="mi">1</span> <span class="k">then</span> <span class="nx">@</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="k">else</span> <span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Return the array index of the given agent id in the sorted set.
If agentset is not sorted, call @sortById() first.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">indexOfID: </span><span class="nf">(id, sorted=true) -&gt;</span> <span class="c1"># -1 if not found</span>
    <span class="nx">@sortById</span><span class="p">()</span> <span class="nx">unless</span> <span class="nx">sorted</span>
    <span class="k">return</span> <span class="nx">@length</span><span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="nx">id</span> <span class="o">is</span> <span class="nx">@last</span><span class="p">().</span><span class="nx">id</span>  <span class="c1"># no &quot;die&quot; calls yet</span>
    <span class="nx">u</span><span class="p">.</span><span class="nx">binarySearch</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nf">(o)-&gt;</span><span class="nx">o</span><span class="p">.</span><span class="nx">id</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>The static <code>ABM.AgentSet.asSet</code> as a method.
Used by agentset methods creating new agentsets.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">asSet: </span><span class="nf">(a) -&gt;</span> <span class="nx">ABM</span><span class="p">.</span><span class="nx">AgentSet</span><span class="p">.</span><span class="nx">asSet</span> <span class="nx">a</span> <span class="c1"># , @</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Similar to above but sorted via <code>id</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">asOrderedSet: </span><span class="nf">(a) -&gt;</span> <span class="nx">@asSet</span><span class="p">(</span><span class="nx">a</span><span class="p">).</span><span class="nx">sortById</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Return string representative of agentset.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">toString: </span><span class="nf">()-&gt;</span> <span class="s">&quot;[&quot;</span><span class="o">+</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="k">for</span> <span class="nx">a</span> <span class="k">in</span> <span class="nx">@</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s">&quot;, &quot;</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;]&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <h3>Property Utilities</h3>

<p>Property access, also useful for debugging<br></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Return an array of a property of the agentset</p>

<pre><code> AS.getProp "x" # [0, 8, 6, 1, 1]
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">getProp: </span><span class="nf">(prop) -&gt;</span> <span class="nx">o</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="k">for</span> <span class="nx">o</span> <span class="k">in</span> <span class="nx">@</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Return an array of arrays of props, given as a string or an array of strings.</p>

<pre><code>AS.getProps "id x y"
AS.getProps ["id", "x", "y"]
[[1,0,1],[2,8,0],[3,6,4],[4,1,3],[5,1,1]]
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">getProps: </span><span class="nf">(props) -&gt;</span> 
    <span class="nv">props = </span><span class="nx">props</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)</span> <span class="k">if</span> <span class="nx">u</span><span class="p">.</span><span class="nx">isString</span> <span class="nx">props</span>
    <span class="p">(</span><span class="nx">o</span><span class="p">[</span><span class="nx">p</span><span class="p">]</span> <span class="k">for</span> <span class="nx">p</span> <span class="k">in</span> <span class="nx">props</span><span class="p">)</span> <span class="k">for</span> <span class="nx">o</span> <span class="k">in</span> <span class="nx">@</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Return an array of agents with the property equal to the given value</p>

<pre><code>AS.getWithProp "x", 1
[{id:4,x:1,y:3},{id:5,x:1,y:1}]
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">getWithProp: </span><span class="nf">(prop, value) -&gt;</span> <span class="nx">@asSet</span> <span class="p">(</span><span class="nx">o</span> <span class="k">for</span> <span class="nx">o</span> <span class="k">in</span> <span class="nx">@</span> <span class="k">when</span> <span class="nx">o</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">is</span> <span class="nx">value</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Set the property of the agents to a given value</p>

<pre><code># increment x for agents with x=1
AS1 = ABM.AgentSet.asSet AS.getWithProp("x",1)
AS1.setProp "x", 2 # {id:4,x:2,y:3},{id:5,x:2,y:1}
</code></pre>

<p>Note this changes the last two objects in the original AS above</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">setProp: </span><span class="nf">(prop, value) -&gt;</span> <span class="nx">o</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span> <span class="k">for</span> <span class="nx">o</span> <span class="k">in</span> <span class="nx">@</span><span class="p">;</span> <span class="nx">@</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Get the agent with the min/max prop value in the agentset</p>

<pre><code>min = AS.minProp "y"  # 0
max = AS.maxProp "y"  # 4
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">maxProp: </span><span class="nf">(prop) -&gt;</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span> <span class="nx">@getProp</span><span class="p">(</span><span class="nx">prop</span><span class="p">)...</span>
  <span class="nv">minProp: </span><span class="nf">(prop) -&gt;</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span> <span class="nx">@getProp</span><span class="p">(</span><span class="nx">prop</span><span class="p">)...</span>
  </pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <h3>Array Utilities, often from ABM.util</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Randomize the agentset</p>

<pre><code>AS.shuffle(); AS.getProp "id" # [3, 2, 1, 4, 5] 
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">shuffle: </span><span class="o">-&gt;</span> <span class="nx">u</span><span class="p">.</span><span class="nx">shuffle</span> <span class="nx">@</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Sort the agentset by the agent's <code>id</code>.</p>

<pre><code>AS.shuffle();  AS.getProp "id"  # [3, 2, 1, 4, 5] 
AS.sortById(); AS.getProp "id"  # [1, 2, 3, 4, 5]
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">sortById: </span><span class="o">-&gt;</span> <span class="nx">u</span><span class="p">.</span><span class="nx">sortBy</span> <span class="nx">@</span><span class="p">,</span> <span class="s">&quot;id&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Make a copy of an agentset, return as new agentset.<br>
NOTE: does <em>not</em> duplicate the objects, simply creates a new agentset
with references to the same agents.  Ex: create a randomized version of AS
but without mangling AS itself:</p>

<pre><code>as = AS.clone().shuffle()
AS.getProp "id"  # [1, 2, 3, 4, 5]
as.getProp "id"  # [2, 4, 0, 1, 3]
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">clone: </span><span class="o">-&gt;</span> <span class="nx">@asSet</span> <span class="nx">u</span><span class="p">.</span><span class="nx">clone</span> <span class="nx">@</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>Return the last agent in the agentset</p>

<pre><code>AS.last().id             # l5
l=AS.last(); p=[l.x,l.y] # [1,1]
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">last: </span><span class="o">-&gt;</span> <span class="nx">u</span><span class="p">.</span><span class="nx">last</span> <span class="nx">@</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>Returns true if the agentset has any agents</p>

<pre><code>AS.any()  # true
AS.getWithProp("x", 99).any() #false
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">any: </span><span class="o">-&gt;</span> <span class="nx">u</span><span class="p">.</span><span class="nx">any</span> <span class="nx">@</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>Return an agentset without given agent a</p>

<pre><code>as = AS.clone().other(AS[0])
as.getProp "id"  # [1, 2, 3, 4] 
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">other: </span><span class="nf">(a) -&gt;</span> <span class="nx">@asSet</span> <span class="p">(</span><span class="nx">o</span> <span class="k">for</span> <span class="nx">o</span> <span class="k">in</span> <span class="nx">@</span> <span class="k">when</span> <span class="nx">o</span> <span class="o">isnt</span> <span class="nx">a</span><span class="p">)</span> <span class="c1"># could clone &amp; remove</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Return random agent in agentset</p>

<pre><code>AS.oneOf()  # {id:2,x:6,y:4}
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">oneOf: </span><span class="o">-&gt;</span> <span class="nx">u</span><span class="p">.</span><span class="nx">oneOf</span> <span class="nx">@</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>Return agentset made of n distinct agents</p>

<pre><code>AS.nOf(3) # [{id:0,x:0,y:1}, {id:4,x:1,y:1}, {id:1,x:8,y:0}]
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">nOf: </span><span class="nf">(n) -&gt;</span> <span class="nx">@asSet</span> <span class="nx">u</span><span class="p">.</span><span class="nx">nOf</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">n</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>Return agent when f(o) min/max in agentset. If multiple agents have
min/max value, return the first. Error if agentset empty.
If f is a string, return element with min/max value of that property.
If "valueToo" then return an array of the agent and the value.</p>

<pre><code>AS.minOneOf("x") # {id:0,x:0,y:1}
AS.maxOneOf((a)-&gt;a.x+a.y, true) # {id:2,x:6,y:4},10 
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">minOneOf: </span><span class="nf">(f, valueToo=false) -&gt;</span>
    <span class="nx">u</span><span class="p">.</span><span class="nx">minOneOf</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">f</span><span class="p">,</span> <span class="nx">valueToo</span>
  <span class="nv">maxOneOf: </span><span class="nf">(f, valueToo=false) -&gt;</span>
    <span class="nx">u</span><span class="p">.</span><span class="nx">maxOneOf</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">f</span><span class="p">,</span> <span class="nx">valueToo</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <h3>Drawing</h3>

<p>For agentsets who's agents have a <code>draw</code> method.
Clears the graphics context (transparent), then
calls each agent's draw(ctx) method.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">draw: </span><span class="nf">(ctx) -&gt;</span>
    <span class="nx">u</span><span class="p">.</span><span class="nx">clearCtx</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
    <span class="nx">o</span><span class="p">.</span><span class="nx">draw</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="k">for</span> <span class="nx">o</span> <span class="k">in</span> <span class="nx">@</span> <span class="k">when</span> <span class="o">not</span> <span class="nx">o</span><span class="p">.</span><span class="nx">hidden</span><span class="p">;</span> <span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <h3>Topology</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>For ABM.patches &amp; ABM.agents which have x,y. See ABM.util doc.</p>

<p>Return all agents in agentset within d distance from given object.
By default excludes the given object. Uses linear/torus distance
depending on patches.isTorus, and patches width/height if needed.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">inRadius: </span><span class="nf">(o, d, meToo=false) -&gt;</span> <span class="c1"># for any objects w/ x,y</span>
    <span class="nv">d2 = </span><span class="nx">d</span><span class="o">*</span><span class="nx">d</span><span class="p">;</span> <span class="nx">x</span><span class="o">=</span><span class="nx">o</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span> <span class="nx">y</span><span class="o">=</span><span class="nx">o</span><span class="p">.</span><span class="nx">y</span>
    <span class="k">if</span> <span class="nx">ABM</span><span class="p">.</span><span class="nx">patches</span><span class="p">.</span><span class="nx">isTorus</span>
      <span class="nx">w</span><span class="o">=</span><span class="nx">ABM</span><span class="p">.</span><span class="nx">patches</span><span class="p">.</span><span class="nx">numX</span><span class="p">;</span> <span class="nx">h</span><span class="o">=</span><span class="nx">ABM</span><span class="p">.</span><span class="nx">patches</span><span class="p">.</span><span class="nx">numY</span>
      <span class="nx">@asSet</span> <span class="p">(</span><span class="nx">a</span> <span class="k">for</span> <span class="nx">a</span> <span class="k">in</span> <span class="nx">@</span> <span class="k">when</span> <span class="o">\</span>
        <span class="nx">u</span><span class="p">.</span><span class="nx">torusSqDistance</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">,</span><span class="nx">a</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="nx">a</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span><span class="nx">w</span><span class="p">,</span><span class="nx">h</span><span class="p">)</span><span class="o">&lt;=</span><span class="nx">d2</span> <span class="o">and</span> <span class="p">(</span><span class="nx">meToo</span> <span class="o">or</span> <span class="nx">a</span> <span class="o">isnt</span> <span class="nx">o</span><span class="p">))</span>
    <span class="k">else</span>
      <span class="nx">@asSet</span> <span class="p">(</span><span class="nx">a</span> <span class="k">for</span> <span class="nx">a</span> <span class="k">in</span> <span class="nx">@</span> <span class="k">when</span> <span class="o">\</span>
        <span class="nx">u</span><span class="p">.</span><span class="nx">sqDistance</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">,</span><span class="nx">a</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="nx">a</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span><span class="o">&lt;=</span><span class="nx">d2</span> <span class="o">and</span> <span class="p">(</span><span class="nx">meToo</span> <span class="o">or</span> <span class="nx">a</span> <span class="o">isnt</span> <span class="nx">o</span><span class="p">))</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>As above, but also limited to the angle <code>cone</code> around
a <code>heading</code> from object <code>o</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">inCone: </span><span class="nf">(o, heading, cone, radius, meToo=false) -&gt;</span>
    <span class="nv">rSet = </span><span class="nx">@inRadius</span> <span class="nx">o</span><span class="p">,</span> <span class="nx">radius</span><span class="p">,</span> <span class="nx">meToo</span>
    <span class="nx">x</span><span class="o">=</span><span class="nx">o</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span> <span class="nx">y</span><span class="o">=</span><span class="nx">o</span><span class="p">.</span><span class="nx">y</span>
    <span class="k">if</span> <span class="nx">ABM</span><span class="p">.</span><span class="nx">patches</span><span class="p">.</span><span class="nx">isTorus</span>
      <span class="nx">w</span><span class="o">=</span><span class="nx">ABM</span><span class="p">.</span><span class="nx">patches</span><span class="p">.</span><span class="nx">numX</span><span class="p">;</span> <span class="nx">h</span><span class="o">=</span><span class="nx">ABM</span><span class="p">.</span><span class="nx">patches</span><span class="p">.</span><span class="nx">numY</span>
      <span class="nx">@asSet</span> <span class="p">(</span><span class="nx">a</span> <span class="k">for</span> <span class="nx">a</span> <span class="k">in</span> <span class="nx">rSet</span> <span class="k">when</span> <span class="o">\</span>
        <span class="p">(</span><span class="nx">a</span> <span class="o">is</span> <span class="nx">o</span> <span class="o">and</span> <span class="nx">meToo</span><span class="p">)</span> <span class="o">or</span> <span class="nx">u</span><span class="p">.</span><span class="nx">inTorusCone</span><span class="p">(</span><span class="nx">heading</span><span class="p">,</span><span class="nx">cone</span><span class="p">,</span><span class="nx">radius</span><span class="p">,</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">,</span><span class="nx">a</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="nx">a</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span><span class="nx">w</span><span class="p">,</span><span class="nx">h</span><span class="p">))</span>
    <span class="k">else</span>
      <span class="nx">@asSet</span> <span class="p">(</span><span class="nx">a</span> <span class="k">for</span> <span class="nx">a</span> <span class="k">in</span> <span class="nx">rSet</span> <span class="k">when</span> <span class="o">\</span>
        <span class="p">(</span><span class="nx">a</span> <span class="o">is</span> <span class="nx">o</span> <span class="o">and</span> <span class="nx">meToo</span><span class="p">)</span> <span class="o">or</span> <span class="nx">u</span><span class="p">.</span><span class="nx">inCone</span><span class="p">(</span><span class="nx">heading</span><span class="p">,</span><span class="nx">cone</span><span class="p">,</span><span class="nx">radius</span><span class="p">,</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">,</span><span class="nx">a</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="nx">a</span><span class="p">.</span><span class="nx">y</span><span class="p">))</span>    </pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <h3>Debugging</h3>

<p>Useful in console.
Also see <a href="http://goo.gl/1i7bd">CoffeeConsole</a> Chrome extension.</p>             </td>             <td class="code">               <div class="highlight"><pre>  </pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>Similar to NetLogo ask &amp; with operators.
Allows functions as strings. Use:</p>

<pre><code>AS.getProp("x") # [1, 8, 6, 2, 2]
AS.with("o.x&lt;5").ask("o.x=o.x+1")
AS.getProp("x") # [2, 8, 6, 3, 3]

ABM.agents.with("o.id&lt;100").ask("o.color=[255,0,0]")
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">ask: </span><span class="nf">(f) -&gt;</span> 
    <span class="nb">eval</span><span class="p">(</span><span class="s">&quot;f=function(o){return &quot;</span><span class="o">+</span><span class="nx">f</span><span class="o">+</span><span class="s">&quot;;}&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="nx">u</span><span class="p">.</span><span class="nx">isString</span> <span class="nx">f</span>
    <span class="nx">f</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="k">for</span> <span class="nx">o</span> <span class="k">in</span> <span class="nx">@</span><span class="p">;</span> <span class="nx">@</span>
  <span class="nv">with: </span><span class="nf">(f) -&gt;</span> 
    <span class="nb">eval</span><span class="p">(</span><span class="s">&quot;f=function(o){return &quot;</span><span class="o">+</span><span class="nx">f</span><span class="o">+</span><span class="s">&quot;;}&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="nx">u</span><span class="p">.</span><span class="nx">isString</span> <span class="nx">f</span>
    <span class="nx">@asSet</span> <span class="p">(</span><span class="nx">o</span> <span class="k">for</span> <span class="nx">o</span> <span class="k">in</span> <span class="nx">@</span> <span class="k">when</span> <span class="nx">f</span><span class="p">(</span><span class="nx">o</span><span class="p">))</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>The example agentset AS used in the code fragments was made like this,
slightly more useful than shown above due to the toString method.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">XY</span>
  <span class="nv">constructor: </span><span class="nf">(@x,@y) -&gt;</span>
  <span class="nv">toString: </span><span class="o">-&gt;</span> <span class="s">&quot;{id:</span><span class="si">#{</span><span class="nx">@id</span><span class="si">}</span><span class="s">,x:</span><span class="si">#{</span><span class="nx">@x</span><span class="si">}</span><span class="s">,y:</span><span class="si">#{</span><span class="nx">@y</span><span class="si">}</span><span class="s">}&quot;</span>
<span class="vi">@AS = </span><span class="k">new</span> <span class="nx">ABM</span><span class="p">.</span><span class="nx">AgentSet</span> <span class="c1"># @ =&gt; global name space</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>The result of </p>

<pre><code>AS.add new XY(u.randomInt(10), u.randomInt(10)) for i in [1..5]
</code></pre>

<p>random run, captured so we can reuse.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">AS</span><span class="p">.</span><span class="nx">add</span> <span class="k">new</span> <span class="nx">XY</span><span class="p">(</span><span class="nx">pt</span><span class="p">...)</span> <span class="k">for</span> <span class="nx">pt</span> <span class="k">in</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">8</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]]</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 