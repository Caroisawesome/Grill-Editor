<!DOCTYPE html>  <html> <head>   <title>template.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="agentset.html">                 agentset.coffee               </a>                                           <a class="source" href="agentsets.html">                 agentsets.coffee               </a>                                           <a class="source" href="model.html">                 model.coffee               </a>                                           <a class="source" href="shapes.html">                 shapes.coffee               </a>                                           <a class="source" href="template.html">                 template.coffee               </a>                                           <a class="source" href="util.html">                 util.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               template.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>This is a general template for creating models.</p>

<p>To build your own model, extend class ABM.Model supplying the 
two abstract methods <code>setup</code> and <code>step</code>.  <code>@foo</code> signifies
an instance variable or method.
See <a href="http://jashkenas.github.com/coffee-script/#classes">CoffeeScript docs</a>
for explanation of context of a class and its constructor.</p>

<p>We do not provide a constructor of our own. 
CoffeeScript automatically calls <code>Model.constructor &lt;args&gt;</code>
and <code>setup</code> will be called by <code>Model.constructor</code>. See:</p>

<pre><code>APP=new MyModel "layers", 13, -16, 16, -16, 16
</code></pre>

<p>below, which passes all its arguments to <code>Model</code></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">MyModel</span> <span class="k">extends</span> <span class="nx">ABM</span><span class="p">.</span><span class="nx">Model</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Static private variables, useful for "aliases" w/o adding to global namespace</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">u = </span><span class="nx">ABM</span><span class="p">.</span><span class="nx">util</span>
  <span class="nv">log = </span><span class="nf">(arg) -&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">arg</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Initialize our model via the <code>setup</code> abstract method.
This model simply creates <code>population</code> agents with
arbitrary shapes with <code>size</code> size and <code>speed</code> velocity.
We also periodically change the patch colors to random gray values.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">setup: </span><span class="o">-&gt;</span> <span class="c1"># called by Model.constructor        </span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>First, we initialize our model instance variables.
Most instance variables are parameters we would like
an external UI to setup for us.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="vi">@population = </span><span class="mi">100</span>
    <span class="vi">@size = </span><span class="mf">1.5</span>   <span class="c1"># size in patch coords</span>
    <span class="vi">@speed = </span><span class="p">.</span><span class="mi">5</span>   <span class="c1"># move forward this amount in patch coords</span>
    <span class="vi">@wiggle = </span><span class="nx">u</span><span class="p">.</span><span class="nx">degToRad</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="c1"># degrees/radians to wiggle</span>
    <span class="vi">@startCircle = </span><span class="kc">true</span>  <span class="c1"># initialize agents randomly or in circle</span>
    <span class="vi">@debug = </span><span class="kc">true</span> <span class="c1"># turn on/off use of setRootVars() below</span>
    </pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>The patch grid will have been setup for us.  Here we initialize
patch variables, either built-in ones or any new patch variables
our model needs. In this case, we set the built-in color to a
random gray value.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">for</span> <span class="nx">p</span> <span class="k">in</span> <span class="nx">@patches</span>
      <span class="nv">p.color = </span><span class="nx">u</span><span class="p">.</span><span class="nx">randomGray</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Our empty @agents AgentSet will have been created.  Here we
add <code>population</code> Agents we use in our model.
We set the build-in Agent variables <code>size</code> and <code>shape</code> 
and layout the agents randomly or in a circle depending
on our modeel's <code>startCircle</code> variable.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">for</span> <span class="nx">a</span> <span class="k">in</span> <span class="nx">@agents</span><span class="p">.</span><span class="nx">create</span> <span class="nx">@population</span>
      <span class="nv">a.size = </span><span class="nx">@size</span>
      <span class="nv">a.shape = </span><span class="nx">u</span><span class="p">.</span><span class="nx">oneOf</span> <span class="nx">ABM</span><span class="p">.</span><span class="nx">shapes</span><span class="p">.</span><span class="nx">names</span><span class="p">()</span> <span class="c1"># random shapes</span>
      <span class="k">if</span> <span class="nx">@startCircle</span>
        <span class="nx">a</span><span class="p">.</span><span class="nx">forward</span> <span class="nx">@patches</span><span class="p">.</span><span class="nx">maxX</span><span class="o">/</span><span class="mi">2</span> <span class="c1"># start in circle</span>
      <span class="k">else</span>
        <span class="nx">a</span><span class="p">.</span><span class="nx">setXY</span> <span class="nx">@patches</span><span class="p">.</span><span class="nx">randomPt</span><span class="p">()...</span> <span class="c1"># set random location</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Print number of agents and patches to the console.
Note CoffeeScript
<a href="http://jashkenas.github.com/coffee-script/#strings">string interpolation</a></p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">log</span> <span class="s">&quot;total agents: </span><span class="si">#{</span><span class="nx">@agents</span><span class="p">.</span><span class="nx">length</span><span class="si">}</span><span class="s">, total patches: </span><span class="si">#{</span><span class="nx">@patches</span><span class="p">.</span><span class="nx">length</span><span class="si">}</span><span class="s">&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Print number of agents with each shape</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">for</span> <span class="nx">s</span> <span class="k">in</span> <span class="nx">ABM</span><span class="p">.</span><span class="nx">shapes</span><span class="p">.</span><span class="nx">names</span><span class="p">()</span>
      <span class="nv">num = </span><span class="nx">@agents</span><span class="p">.</span><span class="nx">getWithProp</span><span class="p">(</span><span class="s">&quot;shape&quot;</span><span class="p">,</span> <span class="nx">s</span><span class="p">).</span><span class="nx">length</span>
      <span class="nx">log</span> <span class="s">&quot;</span><span class="si">#{</span><span class="nx">num</span><span class="si">}</span><span class="s"> </span><span class="si">#{</span><span class="nx">s</span><span class="si">}</span><span class="s">&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Update our model via the second abstract method, <code>step</code></p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">step: </span><span class="o">-&gt;</span>  <span class="c1"># called by Model.animate</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>First, update our agents via our <code>updateAgents</code> method</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@updateAgents</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="k">for</span> <span class="nx">a</span> <span class="k">in</span> <span class="nx">@agents</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Every 100 steps, update our patches, print stats to 
the console, and use the Model refresh flag to redraw
the patches. Otherwise don't refresh.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@ticks</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">is</span> <span class="mi">0</span>
      <span class="nx">@updatePatches</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span class="k">for</span> <span class="nx">p</span> <span class="k">in</span> <span class="nx">@patches</span>
      <span class="nx">@reportInfo</span><span class="p">()</span> 
      <span class="vi">@refreshPatches = </span><span class="kc">true</span>
    <span class="k">else</span>
      <span class="vi">@refreshPatches = </span><span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Stop the animation at 1000. Restart by <code>APP.start()</code> in console.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">@ticks</span> <span class="o">is</span> <span class="mi">1000</span>
      <span class="nx">log</span> <span class="s">&quot;..stopping, restart by APP.start()&quot;</span>
      <span class="nx">@stop</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Three of our own methods to manage agents &amp; patches
and report model state.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">updateAgents: </span><span class="nf">(a) -&gt;</span> <span class="c1"># a is agent</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Have our agent "wiggle" by changing
our heading by +/- <code>wiggle/2</code> radians</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">a</span><span class="p">.</span><span class="nx">rotate</span> <span class="nx">u</span><span class="p">.</span><span class="nx">randomCentered</span> <span class="nx">@wiggle</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Then move forward by our speed.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">a</span><span class="p">.</span><span class="nx">forward</span> <span class="nx">@speed</span>
  <span class="nv">updatePatches: </span><span class="nf">(p) -&gt;</span> <span class="c1"># p is patch</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Update patch colors to be a random gray.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">p.color = </span><span class="nx">u</span><span class="p">.</span><span class="nx">randomGray</span><span class="p">()</span>
  <span class="nv">reportInfo: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Report the average heading, in radians and degrees</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">headings = </span><span class="nx">@agents</span><span class="p">.</span><span class="nx">getProp</span> <span class="s">&quot;heading&quot;</span>
    <span class="nv">avgHeading = </span><span class="p">(</span><span class="nx">headings</span><span class="p">.</span><span class="nx">reduce</span> <span class="nf">(a,b)-&gt;</span><span class="nx">a</span><span class="o">+</span><span class="nx">b</span><span class="p">)</span> <span class="o">/</span> <span class="nx">@agents</span><span class="p">.</span><span class="nx">length</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Note: multiline strings. block strings also available.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">log</span> <span class="s">&quot;</span>
<span class="s">average heading of agents: </span>
<span class="si">#{</span><span class="nx">avgHeading</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s"> radians, </span>
<span class="si">#{</span><span class="nx">u</span><span class="p">.</span><span class="nx">radToDeg</span><span class="p">(</span><span class="nx">avgHeading</span><span class="p">).</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s"> degrees&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Now that we've build our class, we call it with Model's
constructor arguments:</p>

<pre><code>divName, patchSize, minX, maxX, minY, maxY,
isTorus = true, topLeft=[10,10]
</code></pre>

<p>Note: Netlogo defaults 13, -16, 16, -16, 16 <br>
for patchSize, minX, maxX, minY, maxY</p>

<p>We do not strictly need to set the new model to a local variable,
class Model sets it to <code>ABM.model</code>. We do so here for convenience.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">APP = </span><span class="k">new</span> <span class="nx">MyModel</span> <span class="s">&quot;layers&quot;</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="o">-</span><span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="o">-</span><span class="mi">16</span><span class="p">,</span> <span class="mi">16</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Finally set some debugging aids in the global namespace.
Here @APP is window.APP, see CoffeeScript
<a href="http://jashkenas.github.com/coffee-script/#lexical_scope">lexical scoping</a>
for name scope discussion.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="vi">@APP = </span><span class="nx">APP</span><span class="p">;</span> <span class="nx">APP</span><span class="p">.</span><span class="nx">setRootVars</span><span class="p">())</span> <span class="k">if</span> <span class="nx">APP</span><span class="p">.</span><span class="nx">debug</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 