!function(){var t;t=ABM.util,ABM.DataSet=function(){function h(t,h,i){null==t&&(t=0),null==h&&(h=0),null==i&&(i=[]),this.reset(t,h,i)}return h.patchDataSet=function(t){var i,e;return e=ABM.patches,new h(e.numX,e.numY,function(){var h,r,n;for(n=[],h=0,r=e.length;r>h;h++)i=e[h],n.push(i[t]);return n}())},h.imageDataSet=function(i,e){var r;return null==e&&(e=!1),r=new h,t.importImage(i,function(h){var i,n,a,o,s,u;for(i=t.imageToCtx(h),r.ctx=i,o=id.data,a=[],n=s=0,u=o.length;u>s;n=s+=4)e?a.push(o[n]):a.push(o[n]<<16|o[n+1]<<8|o[n+2]);return r.reset(i.canvas.width,i.canvas.height,a)}),r},h.ascDataSet=function(t){var i,e,r,n,a,o,s,u,l,d;for(a=t.split("\n"),i={},i.data=[],e=o=0;5>=o;e=++o)r=a[e].split(/\s+/),i[r[0].toLowerCase()]=parseFloat(r[1]);for(e=s=0,l=i.nrows;l>s;e=s+=1){for(n=a[6+e].trim().split(" "),e=u=0,d=n.length;d>=0?d>u:u>d;e=d>=0?++u:--u)n[e]=parseFloat(n[e]);i.data=i.data.concat(n)}return new h(i.ncols,i.nrows,i.data)},h.prototype.reset=function(h,i,e){return this.width=h,this.height=i,this.data=e,e.length!==h*i?t.error("DataSet: data array length error:\ndata.length: "+this.data.length+" width: "+this.width+" height: "+this.height):void 0},h.prototype.checkXY=function(h,i){return h>=0&&h<=this.width-1&&i>=0&&i<=this.height-1?void 0:t.error("x,y out of range: "+h+","+i)},h.prototype.nearest=function(t,h){return this.getXY(Math.round(t),Math.round(h))},h.prototype.bilinear=function(t,h){var i,e,r,n,a,o,s,u,l,d,p,c,f;return this.checkXY(t,h),l=Math.floor(t),d=Math.floor(h),s=this.toIndex(l,d),u=this.width,t-=l,h-=d,i=1-t,e=1-h,r=this.data[s],n=null!=(p=this.data[s+u])?p:0,a=null!=(c=this.data[++s])?c:0,o=null!=(f=this.data[s+u])?f:0,r*i*e+a*t*e+n*i*h+o*t*h},h.prototype.toIndex=function(t,h){return t+h*this.width},h.prototype.toXY=function(t){return[t%this.width,Math.floor(t/this.width)]},h.prototype.getXY=function(t,h){return this.checkXY(t,h),this.data[this.toIndex(t,h)]},h.prototype.setXY=function(t,h,i){return this.checkXY(t,h),this.data[this.toIndex(t,h)]=i},h.prototype.toString=function(h,i){var e,r,n,a,o;for(null==h&&(h=!1),null==i&&(i=2),n="width: "+this.width+" height: "+this.height+" data:",e=h?t.aToFixed(this.data,i):this.data,r=a=0,o=this.height;o>=0?o>a:a>o;r=o>=0?++a:--a)n+="\n"+(""+r+": "+e.slice(r*this.width,(r+1)*this.width));return n},h.prototype.toImage=function(h){var i,e,r,n,a,o,s,u,l;for(null==h&&(h=!0),i=t.createCtx(this.width,this.height),r=i.getImageData(0,0,this.width,this.height),s=r.data,a=t.normalize(this.data,0,Math.pow(2,h?8:24)-1e-6),e=u=0,l=a.length;l>u;e=++u)o=a[e],n=4*e,s[n+3]=255,h?s[n]=s[n+1]=s[n+2]=Math.floor(o):(s[n]=o>>>16,s[n+1]=255&o>>8,s[n+2]=255&o);return i.putImageData(r,0,0),i.canvas},h.prototype.setPatchVar=function(t){var h,i,e,r,n,a;for(h=this.resample(ABM.patches.numX,ABM.patches.numY),n=ABM.patches,a=[],e=0,r=n.length;r>e;e++)i=n[e],a.push(i[t]=h.data[i.id]);return a},h.prototype.resample=function(t,i){var e,r,n,a,o,s,u,l,d,p,c;if(t===this.width&&i===this.height)return this;for(e=[],o=(this.width-1)/(t-1),l=(this.height-1)/(i-1),r=o>=1||l>=1,console.log([t,i,o,l,r]),u=p=0;i>p;u=p+=1)for(a=c=0;t>c;a=c+=1)s=a*o,d=u*l,n=r?this.nearest(s,d):this.bilinear(s,d),e.push(n);return console.log([a,u,t,i,e,s,d]),new h(t,i,e)},h.prototype.neighborhood=function(h,i,e){var r,n,a,o,s,u;for(null==e&&(e=[]),e.length=0,n=s=-1;1>=s;n=++s)for(r=u=-1;1>=u;r=++u)a=t.clamp(h+r,0,this.width-1),o=t.clamp(i+n,0,this.height-1),e.push(this.data[this.toIndex(a,o)]);return e},h.prototype.convolve=function(i){var e,r,n,a,o,s,u,l;for(e=[],r=[],a=o=0,u=this.height;u>o;a=o+=1)for(n=s=0,l=this.width;l>s;n=s+=1)this.neighborhood(n,a,r),e.push(t.aSum(t.aPairMul(i,r)));return new h(this.width,this.height,e)},h.prototype.subset=function(i,e,r,n){var a,o,s,u,l,d,p;for((i+r>this.width||e+n>this.height)&&t.error("subSet: params out of range"),a=[],s=u=e,d=e+n;d>u;s=u+=1)for(o=l=i,p=i+r;p>l;o=l+=1)a.push(this.getXY(o,s));return new h(r,n,a)},h}()}.call(this);