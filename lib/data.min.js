!function(){var t,h,i,e,r={}.hasOwnProperty,s=function(t,h){function i(){this.constructor=t}for(var e in h)r.call(h,e)&&(t[e]=h[e]);return i.prototype=h.prototype,t.prototype=new i,t.__super__=h.prototype,t};e=ABM.util,ABM.DataSet=h=function(){function h(t,h,i){null==t&&(t=0),null==h&&(h=0),null==i&&(i=[]),this.reset(t,h,i)}return h.patchDataSet=function(t){var i,e;return new h((e=ABM.patches).numX,e.numY,function(){var h,r,s;for(s=[],h=0,r=e.length;r>h;h++)i=e[h],s.push(i[t]);return s}())},h.importImageDataSet=function(t,h,r){var s;return null==h&&(h=3),s=new i,e.importImage(t,function(t){return s.parse(t),null!=r?r(s):void 0}),s},h.importAscDataSet=function(h,i){var r;return r=new t,e.xhrLoadFile(h,"text",function(t){return r.parse(t),null!=i?i(r):void 0}),r},h.prototype.reset=function(t,h,i){return this.width=t,this.height=h,this.data=i,i.length!==t*h&&e.error("DataSet: data array length error:\ndata.length: "+this.data.length+" width: "+this.width+" height: "+this.height),this},h.prototype.checkXY=function(t,h){return t>=0&&t<=this.width-1&&h>=0&&h<=this.height-1?void 0:e.error("x,y out of range: "+t+","+h)},h.prototype.nearest=function(t,h){return this.getXY(Math.round(t),Math.round(h))},h.prototype.bilinear=function(t,h){var i,e,r,s,n,a,o,u,p,c,l,d,f;return this.checkXY(t,h),p=Math.floor(t),c=Math.floor(h),o=this.toIndex(p,c),u=this.width,t-=p,h-=c,i=1-t,e=1-h,r=this.data[o],s=null!=(l=this.data[o+u])?l:0,n=null!=(d=this.data[++o])?d:0,a=null!=(f=this.data[o+u])?f:0,r*i*e+n*t*e+s*i*h+a*t*h},h.prototype.toIndex=function(t,h){return t+h*this.width},h.prototype.toXY=function(t){return[t%this.width,Math.floor(t/this.width)]},h.prototype.getXY=function(t,h){return this.checkXY(t,h),this.data[this.toIndex(t,h)]},h.prototype.setXY=function(t,h,i){return this.checkXY(t,h),this.data[this.toIndex(t,h)]=i},h.prototype.toString=function(t,h){var i,r,s,n,a;for(null==t&&(t=!1),null==h&&(h=2),s="width: "+this.width+" height: "+this.height+" data:",i=t?e.aToFixed(this.data,h):this.data,r=n=0,a=this.height;a>=0?a>n:n>a;r=a>=0?++n:--n)s+="\n"+(""+r+": "+i.slice(r*this.width,(r+1)*this.width));return s},h.prototype.toImage=function(t){var h,i,r,s,n,a,o,u,p;for(null==t&&(t=!0),h=e.createCtx(this.width,this.height),r=h.getImageData(0,0,this.width,this.height),o=r.data,n=e.normalize(this.data,0,Math.pow(2,t?8:24)-1e-6),i=u=0,p=n.length;p>u;i=++u)a=n[i],s=4*i,o[s+3]=255,t?o[s]=o[s+1]=o[s+2]=Math.floor(a):(o[s]=a>>>16,o[s+1]=255&a>>8,o[s+2]=255&a);return h.putImageData(r,0,0),h.canvas},h.prototype.toDrawing=function(t){var h;return null==t&&(t=!0),ABM.patches.installDrawing(h=this.toImage(t)),h},h.prototype.toPatchVar=function(t){var h,i,e,r,s,n;for(h=this.resample(ABM.patches.numX,ABM.patches.numY),s=ABM.patches,n=[],e=0,r=s.length;r>e;e++)i=s[e],n.push(i[t]=h.data[i.id]);return n},h.prototype.resample=function(t,i){var e,r,s,n,a,o,u,p,c,l,d;if(t===this.width&&i===this.height)return this;for(e=[],a=(this.width-1)/(t-1),p=(this.height-1)/(i-1),r=a>=1||p>=1,u=l=0;i>l;u=l+=1)for(n=d=0;t>d;n=d+=1)o=n*a,c=u*p,s=r?this.nearest(o,c):this.bilinear(o,c),e.push(s);return new h(t,i,e)},h.prototype.neighborhood=function(t,h,i){var r,s,n,a,o,u;for(null==i&&(i=[]),i.length=0,s=o=-1;1>=o;s=++o)for(r=u=-1;1>=u;r=++u)n=e.clamp(t+r,0,this.width-1),a=e.clamp(h+s,0,this.height-1),i.push(this.data[this.toIndex(n,a)]);return i},h.prototype.convolve=function(t){var i,r,s,n,a,o,u,p;for(i=[],r=[],n=a=0,u=this.height;u>a;n=a+=1)for(s=o=0,p=this.width;p>o;s=o+=1)this.neighborhood(s,n,r),i.push(e.aSum(e.aPairMul(t,r)));return new h(this.width,this.height,i)},h.prototype.subset=function(t,i,r,s){var n,a,o,u,p,c,l;for((t+r>this.width||i+s>this.height)&&e.error("subSet: params out of range"),n=[],o=u=i,c=i+s;c>u;o=u+=1)for(a=p=t,l=t+r;l>p;a=p+=1)n.push(this.getXY(a,o));return new h(r,s,n)},h}(),ABM.AscDataSet=t=function(t){function i(t){this.str=null!=t?t:"",i.__super__.constructor.call(this),0!==this.str.length&&this.parse(this.str)}return s(i,t),i.prototype.parse=function(t){var h,i,e,r,s,n,a,o,u;for(this.str=t,r=t.split("\n"),this.header={},h=s=0;5>=s;h=++s)i=r[h].split(/\s+/),this.header[i[0].toLowerCase()]=parseFloat(i[1]);for(h=n=0,o=this.header.nrows;o>n;h=n+=1){for(e=r[6+h].trim().split(" "),h=a=0,u=e.length;u>=0?u>a:a>u;h=u>=0?++a:--a)e[h]=parseFloat(e[h]);this.data=this.data.concat(e)}return this.reset(this.header.ncols,this.header.nrows,this.data)},i.prototype.slopeAndAspect=function(){var t,i,e,r,s,n,a,o,u,p,c,l,d;for(i=this.convolve([-1,0,1,-2,0,2,-1,0,1]),e=this.convolve([-1,-2,-1,0,0,0,1,2,1]),t=[],a=[],u=p=0,l=this.height;l>p;u=p+=1)for(o=c=0,d=this.width;d>c;o=c+=1)r=i.getXY(o,u),s=e.getXY(o,u),a.push(Math.sqrt(r*r+s*s)),n=Math.PI/2+Math.atan2(s,-r),0>n&&(n+=2*Math.PI),t.push(n);return this.slope=new h(this.width,this.height,a),this.aspect=new h(this.width,this.height,t),[this.slope,this.aspect]},i}(h),ABM.ImageDataSet=i=function(t){function h(t,i){this.img=t,this.byteFmt=null!=i?i:3,h.__super__.constructor.call(this),null!=this.img&&this.parse(this.img)}return s(h,t),h.prototype.ByteFmts=[[2],[1,2],[0,1,2],[3,0,1,2]],h.prototype.checkByteFmt=function(){var t;return e.isArray(this.byteFmt)?this.byteFmt.length>4||e.aMax(this.byteFmt)>3||e.aMin(this.byteFmt)<0?e.error("bad ImageDataSet byte format array: "+this.byteFmt):void 0:(1!==(t=this.byteFmt)&&2!==t&&3!==t&&4!==t&&8!==t&&16!==t&&24!==t&&32!==t&&e.error("bad ImageDataSet byte/bit format int: "+this.byteFmt),this.byteFmt>4&&(this.byteFmt=this.byteFmt/8),this.byteFmt=this.ByteFmts[this.byteFmt-1])},h.prototype.parse=function(t){var h,i,r,s,n,a,o,u,p;for(this.img=t,this.checkByteFmt(this.byteFmt),this.ctx=e.imageToCtx(this.img),r=e.ctxToImageData(this.ctx).data,h=n=0,u=r.length;u>n;h=n+=4){for(s=0,p=this.byteFmt,a=0,o=p.length;o>a;a++)i=p[a],s=256*s+r[h+i];this.data.push(s)}return this.reset(this.ctx.canvas.width,this.ctx.canvas.height,this.data)},h}(h)}.call(this);